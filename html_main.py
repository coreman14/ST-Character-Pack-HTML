"""
Main runner for the HTML process
"""

from argparse import Namespace
import os
import sys
from functools import partial

from colorama import init

import args_functions
import classes
import image_functions
import main_functions
import path_functions

HTML_SNIP1 = r""" <!DOCTYPE html>  <html lang="en">  <head>  <link  rel="shortcut icon"  href="FAVICONHERE"  />  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />  <title>"""
# Add Scenario Title before continue
HTML_SNIP2 = r''' Viewer</title>  <style>  body {  text-align: center;  }  .darkText{  color: #999999;  }  .darkButton{  filter: invert(0.6);  }  .blushHover:hover {  backdrop-filter: invert(0.6);  }  #imageList2{  padding-top: 10px;  }  .outerDiv{  position: relative;  text-align: center;  }  .charactersWrap{  display: flex;  flex-wrap: wrap;  justify-content: center; /* here we just put the only child div to the center */  }  .charactersRow{  display: flex;  flex-direction: column;  justify-content: center; /* here we just put the only child div to the center */  align-items: center;  }  .character{  margin: 10px 10px 0 0;  padding: 0px 0px 14px 0px;  display: flex;  flex-wrap: wrap;  justify-content: center; /* here we just put the only child div to the center */  border-radius: 0.5px;  border-color: grey;  border-style: solid;  position: relative;  box-shadow: inset 0px -18px 0px 0px grey;  }  .charactersRow > .character:hover,  .mainPageHoverLink:hover {  background-color: #0026a32f;  }  .character2,  .characterAccess,  .characterAccessList{  margin: 10px 10px 0 0;  padding: 0px 0px;  display: flex;  flex-wrap: nowrap;  justify-content: center; /* here we just put the only child div to the center */  border-radius: 0.5px;  border-color: grey;  border-style: solid;  position: relative;  }  .accessoryElementSelection{  min-width: 200px;  justify-content: unset;  display: block;  overflow-y: auto;  }  .elementTableLine,  .elementHeaderLineAccessories,  .elementHeaderLineOutfit{  display: table;  font-size: 20px;  user-select: none;  padding-left: 3px;  }  .elementHeaderLineAccessories,  .elementHeaderLineOutfit{  font-size: 28px;  padding-top: 4px;  padding-bottom: 2px;  }  .characterAccess,  .characterAccessList{  margin: 10px 2px 0 0;  }  .character2Container{  display: flex;  flex-wrap: wrap;  justify-content: center; /* here we just put the only child div to the center */  }  .character span,  .character2 span {  position: absolute;  background-color: grey;  color: White;  width: 100%;  line-break: anywhere;  font-size: 14px;  }  #changeBox{  position: absolute;  }  .characterImagesOutfitAccessoryViews,  .characterImagesOutfitMainViews{  position: relative;  padding-top: 20px;  left: 0px;  }  .characterImagesOutfitMainViews{  height: 200px; /*Main Height replace*/  }  .characterImagesOutfitAccessoryViews{  height: 400px; /*Access Height replace*/  }  .characterImagesAccessory{  position: absolute;  padding-top: 20px;  left: 0px;  }  .characterPoseName{  position: absolute;  left: 50%;  transform: translate(-50%, -21%);  z-index: 31;  color: White;  background-color: grey; /*This is here to prevent the hover color from overriding the box shadow.*/  width: 100%;  }  #ToggleText{  /*Stolen From W3*/  width: 250px;  position: fixed;  top: 10px;  right: 60px;  font-size: 24px;  opacity: 0;  z-index: -99;  }  #ToggleText.fade{  /*Stolen From W3*/  opacity: 0;  animation: fade 6.25s linear;  }  @keyframes fade {  0% {  opacity: 0;  }  100% {  opacity: 0;  }  0% {  z-index: 6;  }  90% {  z-index: 4;  }  20% {  opacity: 1;  }  68% {  opacity: 1;  }  }  .rotateUp,  .rotateDown{  transition: all 0.75s ease-out;  position: relative;  }  .rotateUp{  transform: rotateX(180deg);  }  .rotateDownNoAnimation{  position: relative;  }  .displayHidden{  display: none;  }  .hidden{  max-height: 0px;  }  .hidden,  .unhidden{  transition: all 0.75s ease-out;  overflow-y: hidden;  }  .unHiddenNoAnimation{  overflow-y: hidden;  }  .dialogOverlay{  background-color: #999999;  color: black;  text-align: center;  border-radius: 15px;  padding: 8px 8px;  overflow: hidden;  border: black;  border-width: 6px;  border-style: solid;  max-width: 80%;  overflow-y: auto;  }  @media screen and (max-width: 500px) {  textarea {  min-width: 95vw;  }  #buttondiv button {  display: block;  &:not(:last-of-type) {  margin-bottom: 30px;  }  }  }  .dialogOverlay::backdrop {  background-color: rgba(0, 0, 0, 0.8);  }  #HelpTitle,  #WelcomeTitle{  font-size: 48px;  display: block;  }  .bigLine{  font-size: 36px !important;  }  .HelpLine{  display: block;  font-size: 24px;  }  .characterPageHelp{  display: block;  font-size: 24px;  }  .boldText{  font-weight: bolder;  }  #backButton{  display: inline-block;  vertical-align: sub;  padding-right: 3px;  height: 25px;  width: auto;  padding-top: 10px;  }  .titleButton{  display: inline-block;  vertical-align: sub;  padding-right: 3px;  height: 25px;  width: auto;  padding-top: 10px;  }  .titleButton.darkButton:hover,  svg:hover,  .infoTextToggles:hover {  filter: invert(0.3);  }  .infoTextToggles,  .underlinedText{  text-decoration: underline;  }  .infoTextItalics{  font-style: italic;  }  #titleSection,  #searchSection{  min-height: 80px;  }  #searchBar{  margin-top: 21px;  font-size: 2em;  width: 50%;  padding-left: 10px;  padding: 3px 10px;  }  #searchBar::placeholder {  text-align: center;  overflow: visible;  }  #title,  #searchBar{  display: inline-block;  }  #titleExtra{  display: inline-block;  }  .titleButton:hover,  .navigationButton:hover,  .outfitLine:not(.tableSelected):hover,  .accessoryLine:hover,  .hideDivSelectionButtonsAllowHover:not(.disallowHover):hover,  #titleExtra:hover,  #title:not(.selectedCharacter):hover,  #hideButton:hover,  #backButton:hover {  filter: invert(0.6);  }  #hideButton{  padding-top: 2px;  display: inline-block;  }  .navigationButton{  top: 0px;  position: fixed;  z-index: 32;  padding: 20px;  }  .navigationButton.leftButton{  left: 0px;  }  .navigationButton.rightButton{  right: 0px;  }  .hideDivSelectionButtons{  display: inline-block;  margin: 0px;  user-select: none;  }  .hideDivSelectionButtonsUnderline{  text-decoration: underline;  }  .alignMiddle,  .alignMiddleImg{  vertical-align: middle;  }  .alignMiddleImg{  padding-right: 3px;  }  .whiteFill{  fill: rgb(255, 255, 255);  }  .blackFill{  fill: rgb(0, 0, 0);  }  #lightMode{  padding-right: 50px;  }  table td {  padding-top: 5px;  padding-bottom: 5px;  font-size: 18px;  }  table th {  padding-top: 5px;  padding-bottom: 5px;  font-size: 28px;  }  table {  width: 100%;  margin-left: auto;  margin-right: auto;  text-align: center;  }  table,  th,  td {  border: 1px solid black;  border-collapse: collapse;  }  th,  .boldTable{  border: 2px solid black;  background-color: #7b7b7b;  }  .exampleTable{  border: 2px solid black;  background-color: #4b4b4b;  }  .keyShortcutLine{  font-size: 28px;  }  .tableDescription{  width: 70%;  }  .prefixTableDescription{  width: 30%;  }  </style>  </head>  <body>  <div id="navigationButtons">  <a class="navigationButton leftButton"  ><img  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAAwCAYAAABNPhkJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsIAAA7CARUoSoAAAAQESURBVGhD5ZpJbE1RGMffQ/S9xsZ7ooZqaNU8xbwQEqzEVmJpSBBDDDGEhaVEEFIrFmqWsGQjtCQ2EiGR2GFhCgslpr5XrfL733Naw73n9b32yb2Xf/LPd8/pbdLf/b4z3HOb+BvKZLOL8F3ciR/iZfZHoStpY9kE3FLCGTzC6zB6jZe/a2l5YJrhqZ+NZRGwiwmn8K+w0nC8xFyGq7IBW9jTeJTXEVGVBRjYhYRG7IJ9g5vNZbjqMzCwCwjKbI3X4ddHvIPxe980w1WfJi0LexaP8Tr8+oQ3AHvRNMNXrzMM7HyCZmMX7Ae8JUqwUq+AgZ1HEGyt1+HXF7wdWN0TKZVc0hb2HK73OvxqxRujCCuVlGFgZxM0Zl2wGrPbogorFZ1hYGcSlNlJXodfOawyPmGa0VRRwMDOIiizLtg83grsSdOMrnosaWBnEFSiLliN2V1xgJUKZhjYaQSVsWKQ2vBuYBtMM/pyAhcB+xXvBPa4acZDgSUN7GSCytgFqzG7L26wkg8YWI1VwWrsBqkd7wf2iGnGS7+VtIVVGWsJCtI3vBfYQ6YZP3VnGNhxBGXWBavt4p44w0pehjOZTH0imVRmtW106TI+gPWQ+qsjRnpNol7pIklm64gXcCFYSUuQ1OPaHTHp732PD3YmEkcFfInGSv3kH5cm2xX905WV57kY4HX929IwfK906wjmf9EHAcdmW9hHvcRXNIZTXBzGm9Tr0Hf8BLfggeqIkbQSPcUNzNR3zLKUzVYQBL1ZbYeu43X80nOWsfhAJ5NKVgd/t+LPnZbN9DG83usI1lW8hl9+a5rxU/cGIpfLdaTT6WaeSBVN125rPB7HzN7E/XoPjp1+2zEB0Q7MTS4LQU/Agm6OI7Rvi+hlOpVqItMjabremARdp4fD/TrLio0C98S5fL49RXknDfR00+vTRDzGQuv9OBYKBJbyudxXjVUuq7ELWgcFtbovLtBOYAmILujReKrX6ZegayoqK2/wkLpeMCKrgsAS0G1A61OnoKd4nX5NZX2rZpZXeeusK7LqEVhSuTKmbzKm9S1JGQ3SdCY6Qau8I5vpooAlyjVv1+mxNF1n1IIebicyvY5FTkUDS0DkbHnrOEhLU5C0lA21E1nkoEsCloBotRNZIWhtWqpS3EdlRAq6ZGDJQivTWosFHqSZTGRDbHl32L7Q1StgyULf4lKTmOvzqT6vDrblrSPe0NVrYAmIz7a8C0HPxYNUEdzfabrCU5+AJQut8tZnGZ2ABmkOvse9j00zPJXlyJX3Y/1r4VqsbAdJD1bQoatsZ8xAvyCswi5o7yA8bJUNWAJaB2Wr8Z//dXcbXzOX4ar7iKecymSzwwjKtmbpR7iRh/GMGLISiR/Sjkbmi9CXxAAAAABJRU5ErkJggg=="  alt="Left button"  id="leftButton"  /></a>  <a class="navigationButton rightButton">  <img  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAAwCAYAAABNPhkJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsIAAA7CARUoSoAAAAQGSURBVGhD5ZpJaxRBGIZn3B1R44y7uIAePSkibnFXEETxIIiIxh3iCoLgL/DgQUVxRYMe3BA8CB5cQBA1bih68+YuOh33aMCMz9tVCRlT05kkA6nWF16q6kslzJOv1u5J+KJ0JrMAP8H1+C6ebn9UUiVt2aECbhzFZTwkDBi9wSuDbPaaaZZGnWzZ0ZqNm8JKQ/EJ/hmzTLM08gW4kIbjqlJC+wJ8A78z1WYS9Emgy02zfepsyw5VbW3t256plObsXNw9DOarL55Bn4f0fWFCbZMXwBIgzwASzDzsgu6HZ7YX2htgCZCnNtMzcY8wmC9BK9P36PvKhFonr4AlQJ4A9J7qHNwtDOZL0OX0uU/f1yZUvLwDlgB5DJBgNLy7hsF8ZfB0m+lWQXsJLNlMf6A6A7vmtKCV6bv01TQoSt4CS4A8AiigqoNJoUxPtdBvTShaXgNLgDy0mdaW1SUM5msAnkaf6mKgvQeWLPRnqhrerkwLegp9btO30AEmVCyAJUDuAfSNqo6ZrkwPxJMttFZ5p2IDLAFSbTOtOe367INwQ6ad0LEClmyma6nqbO3KtKAn0ecWfTX38xQ7YAmQOwDVUdWcdjEMxhNd0LEElgC5DdBPqprTrluf7tPNMh1bYMlCf6c6BbuOoXqooEzfpG9WgcZHPNw3h1H8/dTBd/3G9XgXXqpAAVUncrkVQRA8T5ZlMp0ZD9sJ7sQ6mOsPxEkNn9d1/Gyqarw8SWYXUbmAXRv6v6azmuzz8f8AKy0WsDby/0VfBKzh3KanBzHU/nCVZh5Po9iCR+OcYjGSDiC6Jo7BUS8WDuIdTbcl1buwfEf9kldim6njc4+gehRrLSqkA3hHkM3+ig2cS8D2pziBF4YBt47gbcDqVObHu6W2yMIew4vDgFvHGbFbGQk/bDueR0tgdeFvGZZ1CVjdrBoVuwwDm6YQ7JIw4FZVor6+Mqipacxsg1y3DG8FbBnFIRwFeyqXy21xwUqxAQZW53wtQFGXhNN4U00QfDXN5orFkOaC04fMHKa6zEScOoM3shp/MU23vM9wOp3uzYfUPhoFew5XtgQreZ1hYPskkknBrjARp84zZzcwjD/ZdqS8BWbO9qIQ7Kow4NZF9tn1bD16O1GUvBzSwKYo9uIo2Et4Y2tgJe+A+xnYfXhtGHBLsOuYsx9Ns3h5NaTJrF6CK7MbwoBb+nrTamCbPXMuRt5kGFg9k9qDo2CvYGW2TbCSF8DA6hHTblwZBtwSrDIb+bKsJfmSYb3p32yqTl3Fa9oLK/kCPAEXurldx4It6oV3S/IFuND3NAS7CtiXptl+eXEf7plKKXvj8agwYKRv51UAW9IHjN5sSyxcIykq8Fj8AFeVYs7mK5H4A8xPTiQK7Q/0AAAAAElFTkSuQmCC"  alt="Right button"  id="rightButton"  /></a>  </div>  <span id="ToggleText" class="popup"></span>  <dialog id="favDialog" class="dialogOverlay" onclick="event.target==this && this.close()">  <div id="searchTips" class="displayHidden">  <span id="HelpTitle">Search Tips</span> <br />  <table>  <tr class="boldTable">  <td class="keyShortcutLine" colspan="2" scope="col"  >Matches are found using <span class="boldText underlinedText">sub-string searches</span>.  Searching for <br /><span class="boldText">"m"</span> will match  <span class="boldText">"swimsuit"</span>, <span class="boldText">"uniform"</span>,  <span class="boldText">"maid"</span> etc...</td  >  </tr>  <tr class="boldTable">  <td class="keyShortcutLine" colspan="2" scope="col"  >Multiple searches can be performed by separating them with spaces.</td  >  </tr>  </table>  <br />  <table>  <tr><th class="prefixTableDescription" scope="col">Prefix</th><th scope="col">Filter</th></tr>  <tbody>  <tr>  <td class="boldText">No prefix</td><td>Search <span class="boldText">everywhere</span></td>  </tr>  <tr>  <td class="boldText">&</td><td>Search <span class="boldText">character names</span></td>  </tr>  <tr>  <td class="boldText">!</td  ><td>Search in character <span class="boldText">pose names</span></td>  </tr>  <tr>  <td class="boldText">#</td  ><td>Search in character <span class="boldText">outfit names</span></td>  </tr>  <tr>  <td class="boldText">*</td  ><td>Search in character <span class="boldText">acessory names</span></td>  </tr>  <tr>  <td class="boldText">></td>  <td>Only show poses with <span class="boldText">more faces than the given number</span></td>  </tr>  </tbody>  </table>  <br />  <table>  <tr class="exampleTable">  <td class="keyShortcutLine" colspan="2" scope="col"  ><span class="boldText">Example</span>: "<span class="boldText">!full #maid >20</span>" will  search for a character that has a pose that<br />  contains "<span class="boldText">full</span>", an outfit that contains "<span  class="boldText"  >maid</span  >" and <span class="boldText">20</span> or more faces</td  >  </tr>  </table>  </div>  <div id="HelpDialog">  <span id="HelpTitle">Character Viewer Keyboard Shortcuts</span> <br />  <br />  <table>  <tbody>  <tr><th class="tableDescription" scope="col">Description</th><th scope="col">Key</th></tr>  <tr> <td>Open Shortcuts Page</td> <td class="boldText">I</td> </tr>  <tr>  <td onclick="toggleDarkMode()" class="infoTextToggles" title="Click to toggle dark mode"  >Toggle Dark Mode</td  >  <td class="boldText">D</td>  </tr>  <tr>  <td>Toggle Outfit View mode <span class="boldText">(Main Page Only)</span></td>  <td class="boldText">O</td>  </tr>  <tr>  <td>Show/Hide search <span class="boldText">(Main Page Only)</span></td>  <td class="boldText">F (CTRL-F When using search)</td>  </tr>  <tr>  <td>Show/Hide search tips <span class="boldText">(Main Page Only)</span></td>  <td class="boldText">S</td>  </tr>  <tr>  <td>Close search <span class="boldText">(Main Page Only)</span></td>  <td class="boldText">Escape</td>  </tr>  </tbody></table  >  <br />  <table>  <tbody>  <tr class="boldTable">  <th class="boldText keyShortcutLine" colspan="2" scope="col"  >The following shortcuts can be toggled on/off with the  <span class="infoTextItalics">Backslash</span> Key</th  >  </tr>  <tr><th class="tableDescription" scope="col">Description</th><th scope="col">Key</th></tr>  <tr>  <td  >Increase number of poses needed to be displayed  <span class="boldText">(Main Page Only)</span></td  >  <td class="boldText">Plus</td>  </tr>  <tr>  <td  >Decrease number of poses needed to be displayed  <span class="boldText">(Main Page Only)</span></td  >  <td class="boldText">Minus</td>  </tr>  <tr>  <td>Clear pose filter <span class="boldText">(Main Page Only)</span></td>  <td class="boldText">C</td>  </tr>  <tr>  <td  >Select next character  <span class="boldText"  >(If pressed on the Main Page, will go to first character)</span  ></td  >  <td class="boldText">Right</td>  </tr>  <tr>  <td  >Select previous character  <span class="boldText"  >(If pressed on the Main Page, will go to last character)</span  ></td  >  <td class="boldText">Left</td>  </tr>  <tr>  <td>Go back to Main Page <span class="boldText">(Character view only)</span></td>  <td class="boldText">Up</td>  </tr>  <tr>  <td  >Hide Outfits or Accessories section  <span class="boldText">(Character view only)</span></td  >  <td class="boldText">H</td>  </tr>  <tr>  <td  >Toggle between Outfits and Accessories  <span class="boldText">(Character view only)</span></td  >  <td class="boldText">A</td>  </tr>  <tr>  <td  >If Blushed faces are available, toggle blush on expression sheet  <span class="boldText">(Character view only)</span></td  >  <td class="boldText">B</td>  </tr>  </tbody></table  >  </div>  <div id="WelcomeDialog">  <span id="WelcomeTitle"></span> <br />  <span class="HelpLine"  >To view keyboard shortcuts, click the info icon at the top of page or by pressing  <span class="boldText">I</span></span  ><br />  <span class="HelpLine">Many of the page's elements are intractable,</span>  <span class="HelpLine">Hover over them learn what they do.</span> <br />  <span class="bigLine HelpLine"><span class="boldText">IMPORTANT</span></span  ><br />  <span class="HelpLine"  >The goal of this program is to show an <span class="boldText">approximate</span> view of the  characters included.</span  ><br />  <span class="HelpLine"  >This may result in small visual bugs or mismatches compared to what the in-game sprite viewer  shows.  </span>  <br /><span class="HelpLine boldText bigLine">Please choose a color theme to get started.</span><br />  <div class="hideDivSelectionButtons" id="lightMode" title="Select Light Mode">  <svg width="50" height="50"><rect width="50" height="50" class="whiteFill"></rect></svg>  </div>  <div class="hideDivSelectionButtons" id="darkMode" title="Select Dark Mode">  <svg width="50" height="50"><rect width="50" height="50" class="blackFill"></rect></svg>  </div>  </div>  </dialog>  <div id="titleSection">  <a id="backButton"  ><img  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAGUExURQAAAAAAAKVnuc8AAAACdFJOU/8A5bcwSgAAAAlwSFlzAAAOwwAADsMBx2+oZAAAAG9JREFUOE/FzVEOwCAMAlC9/6U3U6xthejPMn4m5SVr/ZAfQNsO+CLtDZ5IrmMvIjXbNWB7BHQPgO8LiN2B2ieQOwD2PQBoJLfg+AsXVlLmTQo/KbEuQoQDF7FTkSoTpZ2ACbwtBQyBF1LBls9B7w90XAMfmMyTSQAAAABJRU5ErkJggg=="  title="Back to Main Page"  alt="Back button"  id="backbuttonimage"  /></a>  <h1 id="titleExtra">Text</h1> <h1 id="title">Text</h1>  <div class="titleButton" id="infoButton" onclick="popOutHelp()">  <img  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAINSURBVFhHxZe7SgQxFIZH8VLYWNhY2AjiAyh4wcJCtLIRBF9AfAltBPUNxJfQXlAUtfRSC2IvCFoJ2uj/rfllZd2ZZNm4H/zJMJucc3ZykjlTdJqu0MfQJy1JC9KENCYNSvAqPUjX0ol0LH1IbQEn29Kz9BkpxjLHAbbMmvQk2fCttCnNS8NSbxDX3OM3xng8c7GRTI90INnQpTQnxcLYC8nzsYXNKBh4KDHxTVqXUnLFMGdDwga2sBkVhP/5izTDjSZsSWdBq9xoAjacP9guhfXyPy9zDnsSY1FZADAt+Uk0zQky1gnHY68iJQBgORiLjz93B9uGASRczJoPSCNBMWDzXMIHvn7BIeN1Ssn2VGYlfOALnz8sS/zAHs7NnYQvfBbdNILjFY5CH0NqDhi2IyzSOADOdrgKfU7sY5LGAfBigfvQ58Q+RmkcgLcFyZEb+6j5dAAdwwHwPoeh0OfEPmo+HQDFBIyHPif28UjjAKhkIOchZOzjhsYBnIZ+JfQ5sQ/Kth/6pdSjuJWDqOEo9hN4l/a/L4tdqZUCpAps7nxf1nw1FK0dfx1DfUFCEVFGSgBTUmVBYlySsU5lQcQGgHPnV2VJBrFFaVUAzGmpKAUG+kkgKhkyOBbGUqx6PraindfDejkx0b99mNRDxmb7NEvZ7/44pZKhmOB9bge8WDjbOV454dr6cZqRovgCfJ2xnbN9A/cAAAAASUVORK5CYII="  title="Open Shortcuts and Information"  alt="Info button"  />  </div>  <div class="titleButton" id="toggleFind" onclick="toggleSearchBar()">  <img  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAllJREFUWIXF199rjmEYB/DP/GojspUfazLDqDVS40RKSciPv4ADZyRFLSdEaZF2xomDiZxRTtQOREJJ+X2oWCiZHyEWZpvh5H7q7ul53/d5tyf71l3X877XdX2/1/Ne931fb42xoRlbsRGrMB+1+Il+PMYNXMO7MXJkohXnMYC/OdYnnMGCIsj3V0GcXh+xKytpTQ7iGpzFntTnb8MrvotXGMQMLMV6bMKcVMxJHKm28p5UNV/QifoKcfNwPPRFHN9VDXlnKvgRlldZQAeep/LszBPYnlL/AA1Vkidoxoso1wc0VQq6nGqiJWMkT7AmVdDpcs5tGIqc942TPEFXaos2lnI8HDn2he4uAo2BOMm9e1IJxw2RfRU/ChLwDtej501ZAmaGEy/BnYLIE9yO7I4sAbPDgt94XbCAvshuyhJQi2nBHinw9SeI89VlCRgJlcOUIKhI1EX2rywBX/Et2FOxsGABLZH9vpSAl9Hz2oIFrIvsp6W2Ydz528POKAL12BI93yzl2IHRcFiMhFutCMSX2wAWlXPujZyfYfI4yVvxOcp5oVLA5sh5FIfGQV4fbtO4+mXlAhpCH8R3+DAO5pyiYizG/VSuA5XI75WY7UbxEDty/CTTsTdc5XGOnrGSx2skVHU0zH5todJ2bEN3agBJ1rlybzAvedYaCkfscInvByv1UB7y+6G6XvzJKWwYV7CyHHl9DvIn4d9PgtU4EUbyfnwPVQ7gDW7hGFaUI05wsUryrAJawrZqxqw8pDHSc3s15IXg60SSw6mJJBeGju7QQEO4hLn/i/wf3nkLtiSZIk4AAAAASUVORK5CYII="  title="Activate Search"  alt="Activate Search"  />  </div>  </div>  <div id="searchSection" class="displayHidden">  <input  type="text"  id="searchBar"  placeholder="Press Escape or CTRL-F to close"  oninput="updateResults()"  disabled  title="Search for a character. Click the Tips button for help"  />  <div class="titleButton" id="toggleFind" onclick="popOutTips()">  <img  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAlCAYAAAAjt+tHAAAAAXNSR0IArs4c6QAABnhJREFUWIW9WGtoG9kZPaOZkWSNFDuSvEr0jDujRFH1yjiWqyR4lQS5wlKd1ZpQEhPXJRCSECguZrsUGlza7sLCsu1P/cimT0KcH6EL6S604LSwDXjXG9is7VDbmHWtyLEdWZKRHFuP2x/RhKwdOZHa9MCFgXvPPec+5vu+GaBOxGIxlyAIC4IgLEQiEVe98zD1Eqemprqnp6cNAKBUKrsBfFXPPLJ6DeRyOQoAKIp6+vx/NSCBEPJf8bcYCIVCr/M8P9LW1vYOIaTqymiaZuVyOViWBU3T7DYGqba2tnd5nh8JhUKvb+7fcgdmZ2d/NTMzc3hubi7Y2tq6A8Cl503M8/xNQRAWC4UCyuXyp9PT0881cODAgSvj4+M/LBQKoGn6HQCHv7GQzQRBEFwLCwuBYrGITCbjd7vdqmQy+Tep/+LFi2qVStWeTqdbl5aWDKurq6pSqbRz3759DUeOHEnfu3dvHQCGhoaUqVTqyuTkZH+hUIBCoYDZbL6STCb/Xm23AADDw8O0z+f7nUKhIADIjh07yLFjx/rj8TgbCAR+ZjKZZjUaDaEoigAgAAhFUUStVhOLxTIXCATeJoRQ4XD4nFqtJgAIwzCkvb39g22FnwUhhPJ6vR/K5XLicrk+icVibwqC8JVMJnsqynEcYVm2QNP0hiQEgMhkMrJ37967p0+f7nC73dcbGhqI3+9/v5pW1Us2MjLCXL58eUClUiXGxsZ+s7y8rAcAo9G4rNPprmu12luLi4v/XllZKTudzl1LS0tvPHr0qPfBgwdaADCZTI/a29vPp1Ip9e3bt3/70qt/FufOndPbbLZ5AEShUBCPx3Ojr6/PVG38mTNnrB6P54Z0fDabLXH+/PnX6hIHAK/X+0dpa/1+/5WX5fl8vg9YliUAiMvlul6XeFdXl6+5ubkIgAiC8OXQ0JCyFr7L5forANLU1FQKhUIHazbQ2tr6LgCiVCpJMBjsrZXf2dnZ0djYSAAQj8fzXrVxTCwWc929ezcyPz8PlmXJ+vo6LYriVCaTOQwAWq32odVq/aRWAz09PXfu378/kclknLlc7jt+vz8yOjrqZRimWCwWKaPRCJ/P9xcIgpCQzllqTqfzlslkmgRAWlpa/lGruAS73X4DADEajROiKF7drNPS0rLIlEqlLWebSqUeZ7NZBk+y3kq9BpqamlYrj3KdTldEJXuiksQYhlln9u/f36XX608yDCOjKIqUy2WG47gvJiYmXPl8HiqVSl2vgZWVFRUAlMtlwnHcDZvNdp+m6XKpVKLUanWZ5/mPq5J5nv8UALFardMDAwMNtYoTQqg9e/aMVbb6n9XGVa0HOI67AwDZbPZb4+PjnloNRCIRVzabdQGARqMZrdmAwWC4uXPnTqTTaSqZTD43JW+HRCLxo1QqJVer1Whubr5VKx8A4HQ6PwJAGhsbSUdHx+mX5R0/fvz7Ugzgef7z4eHhLWn/hSCEUL29vW1Go3EZADEYDGvRaLTrRbzu7u6QxWJZq0TBYjQajdUjLvN6vddFUbza09PzXb1enwdAzGbzaiQSaa3GO3HihNNsNi9L6fro0aM/FkXxQ7fbfTMej1ct276BeDzO+ny+P9E0TRiGIYFA4O3Ozs7vabXaDQDE4XBUjYoOh+PPAIhcLieHDh36ZUdHx0/kcrmUlD4aHBzkXmjA7/e/zzDM00pHFMU/4Ml9uFqJag/6+/ubNvPOnj2r3b1798PKa/cZAJjN5veerZy8Xu/Vzbwtb0Emk/l2sVgETdPwer3XxsbGfgAADMNMAMDjx4+5RCKh2sybmZlR5fN5FQCwLDsJAPPz829ZLJZfy2RPZHK5nHczb0tVbLfbf14qlZRqtfqzCxcu/JSiqHJFOAcAGxsb8nQ6/RqAFQDSuRYWFxf1a2trdEVoTZpvbm5uwOPxZNbX14NWq/UX1arnFyIYDIal2o/juIcAvgYwV2lfcxz3UCaTEZlMRg4ePPhWfSrbgBBCiaL4+4aGBrI5q0mNpmlit9tH+/r6dP9zAxL8fv/H1Qw4HI7ZS5cuGV+Z+KlTp/S7du1aqmZAo9GQYDBYU/lV08fptWvXlnU63Z1q/RaLZdztdv/rlRkYHBzk8vm8rVp/JpMxT01N7X5lBlKplIwQsl00U7IsW/e/gpfCyZMnBZvN9oUUKaVIZzAYkuFw+MgrFZcQjUYDgiAsS5fPZDJthMPhU/XM9R+JA3T+aqE39AAAAABJRU5ErkJggg=="  title="Search Tips"  alt="Search Tips"  />  </div>  <div class="titleButton" id="toggleFind" onclick="toggleSearchBar()">  <img  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAllJREFUWIXF199rjmEYB/DP/GojspUfazLDqDVS40RKSciPv4ADZyRFLSdEaZF2xomDiZxRTtQOREJJ+X2oWCiZHyEWZpvh5H7q7ul53/d5tyf71l3X877XdX2/1/Ne931fb42xoRlbsRGrMB+1+Il+PMYNXMO7MXJkohXnMYC/OdYnnMGCIsj3V0GcXh+xKytpTQ7iGpzFntTnb8MrvotXGMQMLMV6bMKcVMxJHKm28p5UNV/QifoKcfNwPPRFHN9VDXlnKvgRlldZQAeep/LszBPYnlL/AA1Vkidoxoso1wc0VQq6nGqiJWMkT7AmVdDpcs5tGIqc942TPEFXaos2lnI8HDn2he4uAo2BOMm9e1IJxw2RfRU/ChLwDtej501ZAmaGEy/BnYLIE9yO7I4sAbPDgt94XbCAvshuyhJQi2nBHinw9SeI89VlCRgJlcOUIKhI1EX2rywBX/Et2FOxsGABLZH9vpSAl9Hz2oIFrIvsp6W2Ydz528POKAL12BI93yzl2IHRcFiMhFutCMSX2wAWlXPujZyfYfI4yVvxOcp5oVLA5sh5FIfGQV4fbtO4+mXlAhpCH8R3+DAO5pyiYizG/VSuA5XI75WY7UbxEDty/CTTsTdc5XGOnrGSx2skVHU0zH5todJ2bEN3agBJ1rlybzAvedYaCkfscInvByv1UB7y+6G6XvzJKWwYV7CyHHl9DvIn4d9PgtU4EUbyfnwPVQ7gDW7hGFaUI05wsUryrAJawrZqxqw8pDHSc3s15IXg60SSw6mJJBeGju7QQEO4hLn/i/wf3nkLtiSZIk4AAAAASUVORK5CYII="  title="Activate Search"  alt="Activate Search"  />  </div>  </div>  <div id="selectionButtonDiv">  <h2  class="hideDivSelectionButtons hideDivSelectionButtonsUnderline"  id="outfitsSelect"  title="Show outfits"  >  Outfits  </h2>  <h2  class="hideDivSelectionButtons hideDivSelectionButtonsUnderline"  id="accessorySelect"  title="Show accessories"  >  Accessories  </h2>  </div>  <div id="hideDiv" class="unhidden">  <div id="imageList" class="charactersWrap"></div>  <div class="character2Container hidden" id="accessoryBuilder"></div>  </div>  <div id="hideButton">  <img  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAUBAMAAADSJhiXAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAGUExURWBgYP///w85EMkAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAXSURBVCjPY8ADGAVxgFGpYSSFCzAwAABZWxzDrkDX/gAAAABJRU5ErkJggg=="  id="changeBox"  alt="Box for arrow"  />  <img  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAUCAYAAAAgCAWkAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAGhSURBVFhH7dY7KIVhHMfx41rkFhIGZHAZiBRKGWQwyEgGJZeiJCUiRgaLZMMmg41MCpsMisXAhEKJEiH3+P6U+vc66OBclF99hvOe8z7P/7zP+1xc//kj6cUMkl8/BWaCUYhZtOuCu6ThCs84RwdCEEhJwSgeoDr3kYh36YJ+YG2gBP5OFFpxCFvfJVrgNpXYgb3hCROIhz9SgVXYmjQyulaMTxOOAVzDNnCKJgTBF8nGNB5h69hFIzxKBhZgGxI9kXx4K3EYxAlsv2cYQSy+nRrswTasYdZEjMFvphZbsH3dYx55+JVEYhh3sB0doQ4/TREW4XyltADpYXolOViG7VCWkAVPo2V1HBew7ekhdSMaXk891KEt4BZDiMBX0SLShgPYNjTyk8iET6P5MgZ3q001Pko51uG8bwVl8GsKsAZbmGjSpuMtqdBRyTnvtLg0QPMyIKLzUjO0F9lCtVf1ow86ItnvbqBFJQkBmQRMQacGW7jTHHLhqw34RynFJpx/YhtVCMOfSig6oddLS28PvDovfDHMOrYrx9Do/OfruFwvjpSeW9iun1cAAAAASUVORK5CYII="  class="rotateUp"  id="changeArrow"  alt="Arrow for hiding"  />  </div>  <div id="imageList2"></div>  <script>  /* jshint esversion: 11, -W083*/ var darkBackground="#696969ff";  /* Prettier doesn't like multiple dialogs, so we have to do display things instead*/ function popOutHelp() {  document.getElementById("HelpDialog").classList.remove("displayHidden");  document.getElementById("searchTips").classList.add("displayHidden");  var dialog=document.getElementById("favDialog");  dialog.showModal();  }  function popOutTips() {  document.getElementById("searchTips").classList.remove("displayHidden");  document.getElementById("HelpDialog").classList.add("displayHidden");  var dialog=document.getElementById("favDialog");  dialog.showModal();  }  function RGBAtoRGB(rgb_string, r2=255, g2=255, b2=255) {  var rgb="";  if (rgb_string.startsWith("rgba")) {  rgb=rgb_string.match(/[\.\d]+/g);  r=parseInt(rgb[0]);  g=parseInt(rgb[1]);  b=parseInt(rgb[2]);  a=parseFloat(rgb[3]);  } else if (rgb_string.startsWith("#")) {  n=2;  rgb=rgb_string.substring(1).match(new RegExp(".{1," + n + "}", "g"));  r=parseInt(rgb[0], 16);  g=parseInt(rgb[1], 16);  b=parseInt(rgb[2], 16);  a=parseInt(rgb[3], 16) / 255;  } else {  return rgb_string;  }  var r3=Math.round((1 - a) * r2 + a * r);  var g3=Math.round((1 - a) * g2 + a * g);  var b3=Math.round((1 - a) * b2 + a * b);  return "rgb(" + r3 + "," + g3 + "," + b3 + ")";  }  function parseTextBool(textToParse) {  return textToParse=="true" ? true : false;  }  function makeUrlCompatible(url) {  return url.replace("#", "%23");  }  function getTextWidth(text, font) {  /*Make a canvas object and assign it to the function for better performance*/ const canvas= getTextWidth.canvas || (getTextWidth.canvas=document.createElement("canvas"));  const context=canvas.getContext("2d");  context.font=font;  const metrics=context.measureText(text);  return metrics.width;  }  function compareDefaultAcc(a, b) {  a=parseInt(a.layer);  b=parseInt(b.layer);  if (a < b) {  return -1;  }  if (a > b) {  return 1;  }  return 0;  }  function getIndexOfOutfit(outfit, outfits) {  for (var i in outfits) {  if (outfits[i].path==outfit) {  return parseInt(i);  }  }  return -1;  }  function loadImages(sources, callback) {  var images={};  var loadedImages=0;  var numImages=sources.length;  for (var src in sources) {  images[src]=new Image();  images[src].onload=function () {  if (++loadedImages >= numImages) {  callback(images);  }  };  images[src].src=makeUrlCompatible(sources[src]);  }  }  function makeCharURL(namePose, urlToMend) {  var splitted=namePose.toString().split(",");  urlToMend.searchParams.set("character", splitted[0]);  urlToMend.searchParams.set("pose", splitted[1]);  }  function getLayeringOrderOutfits(out_start, outfit, outfits) {  var default_outfit=[].concat(out_start + outfit);  if (outfits.length > 0) {  var negativeOffset=0;  outfits.sort(compareDefaultAcc);  for (var src in outfits) {  if (parseInt(outfits[src].layer) < 0) {  default_outfit.splice(  negativeOffset,  0,  [].concat(outfits[src].path, outfits[src].main_height)  );  negativeOffset++;  } else {  default_outfit.push([].concat(outfits[src].path, outfits[src].main_height));  }  }  }  return default_outfit;  }  function getLayeringOrderWithAccessories(out_start, outfit, outfits) {  var default_outfit=[].concat(out_start + outfit);  index_of_outfit=getIndexOfOutfit(outfit, outfits);  var negativeOffset=0;  copy_of_accessories=[...outfits[index_of_outfit].off_accessories];  for (var i of outfits[index_of_outfit].on_accessories) {  if (  references_to_accessories_on.includes(properAccessoryName(i)) ||  (non_face_accessories_to_add.includes(i.name) && !i.is_face)  ) {  copy_of_accessories.push(i);  }  }  copy_of_accessories.sort(compareDefaultAcc);  for (var src in copy_of_accessories) {  if (parseInt(copy_of_accessories[src].layer) < 0) {  default_outfit.splice(negativeOffset, 0, {  "path": copy_of_accessories[src].path,  "access_height": copy_of_accessories[src].access_height,  "name": copy_of_accessories[src].name,  "state": copy_of_accessories[src].state,  "is_face": copy_of_accessories[src].is_face,  });  negativeOffset++;  } else {  default_outfit.push({  "path": copy_of_accessories[src].path,  "access_height": copy_of_accessories[src].access_height,  "name": copy_of_accessories[src].name,  "state": copy_of_accessories[src].state,  "is_face": copy_of_accessories[src].is_face,  });  }  }  return default_outfit;  }  function getLayeringOrder(out_start, outfit, default_accessories) {  var default_outfit=[].concat(out_start + outfit);  if (default_accessories.length > 0) {  var negativeOffset=0;  default_accessories.sort(compareDefaultAcc);  for (var src in default_accessories) {  if (!default_accessories[src].path.startsWith(out_start)) {  default_accessories[src].path=out_start + default_accessories[src].path;  }  if (parseInt(default_accessories[src].layer) < 0) {  default_outfit.splice(  negativeOffset,  0,  [].concat(default_accessories[src].path, default_accessories[src].main_height)  );  negativeOffset++;  } else {  default_outfit.push(  [].concat(default_accessories[src].path, default_accessories[src].main_height)  );  }  }  }  return default_outfit;  }  function getLayeringOrderFlat(out_start, outfit, default_accessories) {  var default_outfit=getLayeringOrder(out_start, outfit, default_accessories);  for (var i=0; i < default_outfit.length; i++) {  if (Array.isArray(default_outfit[i])) {  default_outfit[i]=default_outfit[i][0];  }  }  return default_outfit;  }  function changeToFaceNumberingDefault(element) {  body=String(element.name);  pose=String(element.pose);  name_element=element.querySelector(".characterPoseName");  name_element.textContent=String(jsonData[body].poses[pose].faces.length) + " Faces";  }  function changeToPoseDefault(element) {  name=String(element.name);  pose=String(element.pose);  name_element=element.querySelector(".characterPoseName");  name_element.textContent=String(pose);  }  function changeToFaceNumberingOutfit(element) {  body=String(element.name);  pose=String(element.pose);  name_element=element.querySelector(".characterNameSpan");  name_element.textContent=String(jsonData[body].poses[pose].faces.length) + " Faces";  }  function changeToPoseOutfit(element) {  name_element=element.querySelector(".characterNameSpan");  name_element.textContent=element.name + "_" + element.pose;  }  function manipulateImageList() {  elDiv=document.querySelector("#hideDiv");  if (elDiv.classList.contains("hidden")) {  elDiv.classList.add("unhidden");  elDiv.classList.remove("hidden");  document.querySelector("#changeArrow").classList.remove("rotateDown");  document.querySelector("#changeArrow").classList.remove("rotateDownNoAnimation");  document.querySelector("#changeArrow").classList.add("rotateUp");  sessionStorage.setItem("areOutfitsHidden", "false");  elDiv.style.maxHeight=elDiv.getAttribute("currentHeight");  document.querySelector("#changeArrow").title="Hide accessories and Outfits";  outfitsSelect.classList.remove("disallowHover");  accessorySelect.classList.remove("disallowHover");  calculateImageListMaxHeight(false); /*We have to redo it for some reason for everything to work*/  } else {  elDiv.style.maxHeight=elDiv.getAttribute("currentHeight");  elDiv.classList.add("hidden");  elDiv.classList.remove("unhidden");  elDiv.classList.remove("unHiddenNoAnimation");  elDiv.style.maxHeight="";  document.querySelector("#changeArrow").title="Show accessories and Outfits";  document.querySelector("#changeArrow").classList.add("rotateDown");  document.querySelector("#changeArrow").classList.remove("rotateUp");  sessionStorage.setItem("areOutfitsHidden", "true");  outfitsSelect.classList.add("disallowHover");  accessorySelect.classList.add("disallowHover");  }  }  function calculateImageListMaxHeight(assignClasses=true) {  /*Resize outfit div*/ elDiv=document.querySelector("#hideDiv");  elDiv.setAttribute("currentHeight", elDiv.scrollHeight + "px");  if (elDiv.classList.contains("unhidden") || elDiv.classList.contains("unHiddenNoAnimation")) {  if (assignClasses===true) {  document.querySelector("#hideDiv").classList.remove("unhidden");  document.querySelector("#hideDiv").classList.add("unHiddenNoAnimation");  }  elDiv.style.maxHeight=elDiv.scrollHeight + "px";  }  /*Resize*/ elDiv=document.querySelector("#imageList2");  elDiv.style.height="";  elDiv.style.height=elDiv.scrollHeight + "px";  }  function switchCharactersAdd() {  if (selectedCharacter != undefined) {  newIndex=characterArray.findIndex((element) =>  element.toString().startsWith([selectedCharacter, selectedPose].toString())  );  do {  newIndex=newIndex==indexLen ? 0 : newIndex + 1;  } while (pose_filter > 1 && characterArray[newIndex][2] < pose_filter);  makeCharURL(characterArray[newIndex], newURL);  window.location.href=newURL.toString();  } else {  char_index=0;  while (pose_filter > 1 && characterArray[char_index][2] < pose_filter) {  char_index++;  }  makeCharURL(characterArray[char_index], newURL);  window.location.href=newURL.toString();  }  }  function switchCharactersMinus() {  if (selectedCharacter != undefined) {  newIndex=characterArray.findIndex((element) =>  element.toString().startsWith([selectedCharacter, selectedPose].toString())  );  do {  newIndex=newIndex==0 ? indexLen : newIndex - 1;  } while (pose_filter > 1 && characterArray[newIndex][2] < pose_filter);  makeCharURL(characterArray[newIndex], newURL);  window.location.href=newURL.toString();  } else {  char_index=indexLen;  while (pose_filter > 1 && characterArray[char_index][2] < pose_filter) {  char_index--;  }  makeCharURL(characterArray[char_index], newURL);  window.location.href=newURL.toString();  }  }  function getTitleForAddCharacter() {  newIndex=characterArray.findIndex((element) =>  element.toString().includes([selectedCharacter, selectedPose].toString())  );  do {  newIndex=newIndex==indexLen ? 0 : newIndex + 1;  } while (pose_filter > 1 && characterArray[newIndex][2] < pose_filter);  return characterArray[newIndex][0] + "_" + characterArray[newIndex][1];  }  function getTitleForMinusCharacter() {  newIndex=characterArray.findIndex((element) =>  element.toString().includes([selectedCharacter, selectedPose].toString())  );  do {  newIndex=newIndex==0 ? indexLen : newIndex - 1;  } while (pose_filter > 1 && characterArray[newIndex][2] < pose_filter);  return characterArray[newIndex][0] + "_" + characterArray[newIndex][1];  }  function properAccessoryName(accessory_object) {  return accessory_object.state != ""  ? accessory_object.name + "_" + accessory_object.state  : accessory_object.name;  }  function changeAccessoryOutfit(name_span) {  var i;  outfitButton=name_span.querySelectorAll(".alignMiddleImg")[0];  if (outfitButton.classList.contains("check")) {  return;  }  for (i of document.querySelectorAll(".outfitLine")) {  select_square=i.querySelectorAll(".alignMiddleImg")[0];  select_square.src= "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAFEmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgeG1wOkNyZWF0ZURhdGU9IjIwMjMtMDctMDNUMTM6NTI6NDItMDYwMCIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjMtMDctMDNUMTM6NTU6MzgtMDY6MDAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjMtMDctMDNUMTM6NTU6MzgtMDY6MDAiCiAgIHBob3Rvc2hvcDpEYXRlQ3JlYXRlZD0iMjAyMy0wNy0wM1QxMzo1Mjo0Mi0wNjAwIgogICBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIgogICBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiCiAgIGV4aWY6UGl4ZWxYRGltZW5zaW9uPSIyMCIKICAgZXhpZjpQaXhlbFlEaW1lbnNpb249IjIwIgogICBleGlmOkNvbG9yU3BhY2U9IjEiCiAgIHRpZmY6SW1hZ2VXaWR0aD0iMjAiCiAgIHRpZmY6SW1hZ2VMZW5ndGg9IjIwIgogICB0aWZmOlJlc29sdXRpb25Vbml0PSIyIgogICB0aWZmOlhSZXNvbHV0aW9uPSI3Mi8xIgogICB0aWZmOllSZXNvbHV0aW9uPSI3Mi8xIj4KICAgPHhtcE1NOkhpc3Rvcnk+CiAgICA8cmRmOlNlcT4KICAgICA8cmRmOmxpCiAgICAgIHN0RXZ0OmFjdGlvbj0icHJvZHVjZWQiCiAgICAgIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFmZmluaXR5IFBob3RvIDIgMi4xLjEiCiAgICAgIHN0RXZ0OndoZW49IjIwMjMtMDctMDNUMTM6NTU6MzgtMDY6MDAiLz4KICAgIDwvcmRmOlNlcT4KICAgPC94bXBNTTpIaXN0b3J5PgogIDwvcmRmOkRlc2NyaXB0aW9uPgogPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KPD94cGFja2V0IGVuZD0iciI/PsqWhVcAAAGBaUNDUHNSR0IgSUVDNjE5NjYtMi4xAAAokXWRuUtDQRCHvyRKxIMIEbGwCKJWRmKUoI1FgheoRRLBq0leLiHH470ECbaCraAg2ngV+hdoK1gLgqIIYqu1oo2G57xEiIiZZXa+/e3OsDsL1nBayeh1Hshk81pwwu+aX1h02Z+xY8PJEO0RRVdnQuNhatrHHRYz3rjNWrXP/WtNsbiugKVBeFRRtbzwpPD0al41eVu4TUlFYsKnwn2aXFD41tSjFX4xOVnhL5O1cDAA1lZhV/IXR3+xktIywvJyujPpgvJzH/MlzfHsXEhil3gnOkEm8ONiijEC+BhgRGYfbrz0y4oa+Z5y/iw5yVVkVimisUKSFHn6RC1I9bjEhOhxGWmKZv//9lVPDHor1Zv9UP9kGG89YN+C0qZhfB4aRukIbI9wka3m5w5g+F30zarWvQ+OdTi7rGrRHTjfgI4HNaJFypJN3JpIwOsJtCyA8xoalyo9+9nn+B7Ca/JVV7C7B71y3rH8DXjLZ+43iMieAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA7ElEQVQ4je3VP0oDQRTH8U/GbOclFgzG0pTxMh5DLC1i4SX0MFoImlaJkDto6bKxeLO4CZJN1lJ/MMzA8H7z3vz5zsC6SpzhCMl21XjDPZabkwWuUWG1Z6tybAHDbHiFC3zgFnN8dmRY4BTnOXaFy6bMCu847jD5SeOcSIUyiT07yJm99jB8wV32mCZxAESZffWU+1HyfZpde7ZNTWzquhp769/wrxjWeVz8wqeJrZNAEPHQ+2qS+wXrcBj3MDvRgsNQwPFGIOhRPPRnu+FrIvB1KJi4bE/O9AfsLHsYbKxaYoqR3b6ABR7amX0BUYVIcK45KfQAAAAASUVORK5CYII=";  select_square.classList.replace("check", "noCheck");  i.classList.remove("tableSelected");  i.title="Show outfit " + i.textContent;  }  new_outfit=name_span.name;  for (i of character.poses[selectedPose].outfits) {  if (i.path==new_outfit) {  select_square=name_span.querySelectorAll(".alignMiddleImg")[0];  select_square.src= "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAFEmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgeG1wOkNyZWF0ZURhdGU9IjIwMjMtMDctMDNUMTM6NTI6NDItMDYwMCIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjMtMDctMDNUMTQ6MTE6NDAtMDY6MDAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjMtMDctMDNUMTQ6MTE6NDAtMDY6MDAiCiAgIHBob3Rvc2hvcDpEYXRlQ3JlYXRlZD0iMjAyMy0wNy0wM1QxMzo1Mjo0Mi0wNjAwIgogICBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIgogICBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiCiAgIGV4aWY6UGl4ZWxYRGltZW5zaW9uPSIyMCIKICAgZXhpZjpQaXhlbFlEaW1lbnNpb249IjIwIgogICBleGlmOkNvbG9yU3BhY2U9IjEiCiAgIHRpZmY6SW1hZ2VXaWR0aD0iMjAiCiAgIHRpZmY6SW1hZ2VMZW5ndGg9IjIwIgogICB0aWZmOlJlc29sdXRpb25Vbml0PSIyIgogICB0aWZmOlhSZXNvbHV0aW9uPSI3Mi8xIgogICB0aWZmOllSZXNvbHV0aW9uPSI3Mi8xIj4KICAgPHhtcE1NOkhpc3Rvcnk+CiAgICA8cmRmOlNlcT4KICAgICA8cmRmOmxpCiAgICAgIHN0RXZ0OmFjdGlvbj0icHJvZHVjZWQiCiAgICAgIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFmZmluaXR5IFBob3RvIDIgMi4xLjEiCiAgICAgIHN0RXZ0OndoZW49IjIwMjMtMDctMDNUMTQ6MTE6NDAtMDY6MDAiLz4KICAgIDwvcmRmOlNlcT4KICAgPC94bXBNTTpIaXN0b3J5PgogIDwvcmRmOkRlc2NyaXB0aW9uPgogPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KPD94cGFja2V0IGVuZD0iciI/PohIZ3IAAAGBaUNDUHNSR0IgSUVDNjE5NjYtMi4xAAAokXWRuUtDQRCHvyRKxIMIEbGwCKJWRmKUoI1FgheoRRLBq0leLiHH470ECbaCraAg2ngV+hdoK1gLgqIIYqu1oo2G57xEiIiZZXa+/e3OsDsL1nBayeh1Hshk81pwwu+aX1h02Z+xY8PJEO0RRVdnQuNhatrHHRYz3rjNWrXP/WtNsbiugKVBeFRRtbzwpPD0al41eVu4TUlFYsKnwn2aXFD41tSjFX4xOVnhL5O1cDAA1lZhV/IXR3+xktIywvJyujPpgvJzH/MlzfHsXEhil3gnOkEm8ONiijEC+BhgRGYfbrz0y4oa+Z5y/iw5yVVkVimisUKSFHn6RC1I9bjEhOhxGWmKZv//9lVPDHor1Zv9UP9kGG89YN+C0qZhfB4aRukIbI9wka3m5w5g+F30zarWvQ+OdTi7rGrRHTjfgI4HNaJFypJN3JpIwOsJtCyA8xoalyo9+9nn+B7Ca/JVV7C7B71y3rH8DXjLZ+43iMieAAAACXBIWXMAAAsTAAALEwEAmpwYAAABAklEQVQ4je3VQUrDQBTG8V9jsvMSAYt1aXfWE3gL915AdCdYFx5CPYUn0IKgrqVCriC6NKQuZoJtkCatS/1gmAzD++fNm5lvehaVYx9bSCxXhVfcoWhOZrhAidmKrYyxGaQReIZjfOAaz/hsyTDDLg5j7Awn9TJLvGO7BfKTBjGREnkq1GwjZvYSxwcdYbdCDW9whFEqbABhmbCH047Atwh8jON+4ns322q2THVs0nY0VtY/8K8Aq/id/YJTx1apYEGEi36FCc47giaxH8Z+yqI5DNbIbkfDHApcChb0IFz0J93sayjY16bgicX85Nj6BjuODL3GX3OM0NftCZjifj6zL9t8TyFzA/CyAAAAAElFTkSuQmCC";  select_square.classList.replace("noCheck", "check");  name_span.classList.add("tableSelected");  name_span.title="";  setupAccessoryView(new_outfit, true);  }  }  }  function manipulateAccessories(accessory_name_span, remove=false) {  var i;  accessory_name=accessory_name_span.getAttribute("accessoryName");  accessory_state=accessory_name_span.getAttribute("accessoryState");  is_face=parseTextBool(accessory_name_span.getAttribute("is_face"));  outfit=document.querySelector("#AccessoryBuilderOutfit").name;  acc_check=accessory_name_span.querySelectorAll(".alignMiddleImg")[0];  new_access_name=properAccessoryName({ "name": accessory_name, "state": accessory_state });  accessories_to_fix=[];  if (remove) {  references_to_accessories_on=references_to_accessories_on.filter(  (item) => item !== new_access_name  );  names_of_accessories_on=names_of_accessories_on.filter((item) => item !== accessory_name);  accessory_name_span.onclick=function () {  manipulateAccessories(this);  };  acc_check.src= "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAFEmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgeG1wOkNyZWF0ZURhdGU9IjIwMjMtMDctMDNUMTM6NTI6NDItMDYwMCIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjMtMDctMDNUMTM6NTU6MzgtMDY6MDAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjMtMDctMDNUMTM6NTU6MzgtMDY6MDAiCiAgIHBob3Rvc2hvcDpEYXRlQ3JlYXRlZD0iMjAyMy0wNy0wM1QxMzo1Mjo0Mi0wNjAwIgogICBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIgogICBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiCiAgIGV4aWY6UGl4ZWxYRGltZW5zaW9uPSIyMCIKICAgZXhpZjpQaXhlbFlEaW1lbnNpb249IjIwIgogICBleGlmOkNvbG9yU3BhY2U9IjEiCiAgIHRpZmY6SW1hZ2VXaWR0aD0iMjAiCiAgIHRpZmY6SW1hZ2VMZW5ndGg9IjIwIgogICB0aWZmOlJlc29sdXRpb25Vbml0PSIyIgogICB0aWZmOlhSZXNvbHV0aW9uPSI3Mi8xIgogICB0aWZmOllSZXNvbHV0aW9uPSI3Mi8xIj4KICAgPHhtcE1NOkhpc3Rvcnk+CiAgICA8cmRmOlNlcT4KICAgICA8cmRmOmxpCiAgICAgIHN0RXZ0OmFjdGlvbj0icHJvZHVjZWQiCiAgICAgIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFmZmluaXR5IFBob3RvIDIgMi4xLjEiCiAgICAgIHN0RXZ0OndoZW49IjIwMjMtMDctMDNUMTM6NTU6MzgtMDY6MDAiLz4KICAgIDwvcmRmOlNlcT4KICAgPC94bXBNTTpIaXN0b3J5PgogIDwvcmRmOkRlc2NyaXB0aW9uPgogPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KPD94cGFja2V0IGVuZD0iciI/PsqWhVcAAAGBaUNDUHNSR0IgSUVDNjE5NjYtMi4xAAAokXWRuUtDQRCHvyRKxIMIEbGwCKJWRmKUoI1FgheoRRLBq0leLiHH470ECbaCraAg2ngV+hdoK1gLgqIIYqu1oo2G57xEiIiZZXa+/e3OsDsL1nBayeh1Hshk81pwwu+aX1h02Z+xY8PJEO0RRVdnQuNhatrHHRYz3rjNWrXP/WtNsbiugKVBeFRRtbzwpPD0al41eVu4TUlFYsKnwn2aXFD41tSjFX4xOVnhL5O1cDAA1lZhV/IXR3+xktIywvJyujPpgvJzH/MlzfHsXEhil3gnOkEm8ONiijEC+BhgRGYfbrz0y4oa+Z5y/iw5yVVkVimisUKSFHn6RC1I9bjEhOhxGWmKZv//9lVPDHor1Zv9UP9kGG89YN+C0qZhfB4aRukIbI9wka3m5w5g+F30zarWvQ+OdTi7rGrRHTjfgI4HNaJFypJN3JpIwOsJtCyA8xoalyo9+9nn+B7Ca/JVV7C7B71y3rH8DXjLZ+43iMieAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA7ElEQVQ4je3VP0oDQRTH8U/GbOclFgzG0pTxMh5DLC1i4SX0MFoImlaJkDto6bKxeLO4CZJN1lJ/MMzA8H7z3vz5zsC6SpzhCMl21XjDPZabkwWuUWG1Z6tybAHDbHiFC3zgFnN8dmRY4BTnOXaFy6bMCu847jD5SeOcSIUyiT07yJm99jB8wV32mCZxAESZffWU+1HyfZpde7ZNTWzquhp769/wrxjWeVz8wqeJrZNAEPHQ+2qS+wXrcBj3MDvRgsNQwPFGIOhRPPRnu+FrIvB1KJi4bE/O9AfsLHsYbKxaYoqR3b6ABR7amX0BUYVIcK45KfQAAAAASUVORK5CYII=";  acc_check.classList.replace("check", "noCheck");  if (is_face) {  non_face_accessories_to_add=[];  }  } else {  indexOfOutfit=getIndexOfOutfit(outfit, character.poses[selectedPose].outfits);  if (names_of_accessories_on.includes(accessory_name)) {  accessories_to_fix=references_to_accessories_on.filter((item) =>  item.startsWith(accessory_name + "_")  );  references_to_accessories_on=references_to_accessories_on.filter(  (item) => !item.startsWith(accessory_name + "_")  );  } else {  names_of_accessories_on.push(accessory_name);  }  if (is_face) {  non_face_accessories_to_add=[];  if (accessory_name_span.textContent.includes(" ")) {  non_face_accessories_to_add.push(...accessory_name_span.textContent.split(" "));  }  for (i of document.querySelectorAll('*[is_face="true"]')) {  if (i.textContent != accessory_name_span.textContent) {  references_to_accessories_on=references_to_accessories_on.filter(  (item) => i.textContent != item  );  names_of_accessories_on=names_of_accessories_on.filter(  (item) => i.getAttribute("accessoryName") != item  );  i.onclick=function () {  manipulateAccessories(this);  };  }  }  }  if (accessories_to_fix.length > 0) {  for (i of document.querySelectorAll('*[accessoryName="' + accessory_name + '"]')) {  i.onclick=function () {  manipulateAccessories(this);  };  }  }  references_to_accessories_on.push(new_access_name);  acc_check.src= "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAFEmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgeG1wOkNyZWF0ZURhdGU9IjIwMjMtMDctMDNUMTM6NTI6NDItMDYwMCIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjMtMDctMDNUMTQ6MTE6NDAtMDY6MDAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjMtMDctMDNUMTQ6MTE6NDAtMDY6MDAiCiAgIHBob3Rvc2hvcDpEYXRlQ3JlYXRlZD0iMjAyMy0wNy0wM1QxMzo1Mjo0Mi0wNjAwIgogICBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIgogICBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiCiAgIGV4aWY6UGl4ZWxYRGltZW5zaW9uPSIyMCIKICAgZXhpZjpQaXhlbFlEaW1lbnNpb249IjIwIgogICBleGlmOkNvbG9yU3BhY2U9IjEiCiAgIHRpZmY6SW1hZ2VXaWR0aD0iMjAiCiAgIHRpZmY6SW1hZ2VMZW5ndGg9IjIwIgogICB0aWZmOlJlc29sdXRpb25Vbml0PSIyIgogICB0aWZmOlhSZXNvbHV0aW9uPSI3Mi8xIgogICB0aWZmOllSZXNvbHV0aW9uPSI3Mi8xIj4KICAgPHhtcE1NOkhpc3Rvcnk+CiAgICA8cmRmOlNlcT4KICAgICA8cmRmOmxpCiAgICAgIHN0RXZ0OmFjdGlvbj0icHJvZHVjZWQiCiAgICAgIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFmZmluaXR5IFBob3RvIDIgMi4xLjEiCiAgICAgIHN0RXZ0OndoZW49IjIwMjMtMDctMDNUMTQ6MTE6NDAtMDY6MDAiLz4KICAgIDwvcmRmOlNlcT4KICAgPC94bXBNTTpIaXN0b3J5PgogIDwvcmRmOkRlc2NyaXB0aW9uPgogPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KPD94cGFja2V0IGVuZD0iciI/PohIZ3IAAAGBaUNDUHNSR0IgSUVDNjE5NjYtMi4xAAAokXWRuUtDQRCHvyRKxIMIEbGwCKJWRmKUoI1FgheoRRLBq0leLiHH470ECbaCraAg2ngV+hdoK1gLgqIIYqu1oo2G57xEiIiZZXa+/e3OsDsL1nBayeh1Hshk81pwwu+aX1h02Z+xY8PJEO0RRVdnQuNhatrHHRYz3rjNWrXP/WtNsbiugKVBeFRRtbzwpPD0al41eVu4TUlFYsKnwn2aXFD41tSjFX4xOVnhL5O1cDAA1lZhV/IXR3+xktIywvJyujPpgvJzH/MlzfHsXEhil3gnOkEm8ONiijEC+BhgRGYfbrz0y4oa+Z5y/iw5yVVkVimisUKSFHn6RC1I9bjEhOhxGWmKZv//9lVPDHor1Zv9UP9kGG89YN+C0qZhfB4aRukIbI9wka3m5w5g+F30zarWvQ+OdTi7rGrRHTjfgI4HNaJFypJN3JpIwOsJtCyA8xoalyo9+9nn+B7Ca/JVV7C7B71y3rH8DXjLZ+43iMieAAAACXBIWXMAAAsTAAALEwEAmpwYAAABAklEQVQ4je3VQUrDQBTG8V9jsvMSAYt1aXfWE3gL915AdCdYFx5CPYUn0IKgrqVCriC6NKQuZoJtkCatS/1gmAzD++fNm5lvehaVYx9bSCxXhVfcoWhOZrhAidmKrYyxGaQReIZjfOAaz/hsyTDDLg5j7Awn9TJLvGO7BfKTBjGREnkq1GwjZvYSxwcdYbdCDW9whFEqbABhmbCH047Atwh8jON+4ns322q2THVs0nY0VtY/8K8Aq/id/YJTx1apYEGEi36FCc47giaxH8Z+yqI5DNbIbkfDHApcChb0IFz0J93sayjY16bgicX85Nj6BjuODL3GX3OM0NftCZjifj6zL9t8TyFzA/CyAAAAAElFTkSuQmCC";  acc_check.classList.replace("noCheck", "check");  accessory_name_span.onclick=function () {  manipulateAccessories(this, true);  };  }  for (i of document.querySelectorAll(".accessoryLine")) {  acc_check=i.querySelectorAll(".alignMiddleImg")[0];  accessory_name_span=i.querySelectorAll(".alignMiddle")[0];  if (references_to_accessories_on.includes(i.textContent)) {  i.classList.add("tableSelected");  acc_check.src= "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAFEmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgeG1wOkNyZWF0ZURhdGU9IjIwMjMtMDctMDNUMTM6NTI6NDItMDYwMCIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjMtMDctMDNUMTQ6MTE6NDAtMDY6MDAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjMtMDctMDNUMTQ6MTE6NDAtMDY6MDAiCiAgIHBob3Rvc2hvcDpEYXRlQ3JlYXRlZD0iMjAyMy0wNy0wM1QxMzo1Mjo0Mi0wNjAwIgogICBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIgogICBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiCiAgIGV4aWY6UGl4ZWxYRGltZW5zaW9uPSIyMCIKICAgZXhpZjpQaXhlbFlEaW1lbnNpb249IjIwIgogICBleGlmOkNvbG9yU3BhY2U9IjEiCiAgIHRpZmY6SW1hZ2VXaWR0aD0iMjAiCiAgIHRpZmY6SW1hZ2VMZW5ndGg9IjIwIgogICB0aWZmOlJlc29sdXRpb25Vbml0PSIyIgogICB0aWZmOlhSZXNvbHV0aW9uPSI3Mi8xIgogICB0aWZmOllSZXNvbHV0aW9uPSI3Mi8xIj4KICAgPHhtcE1NOkhpc3Rvcnk+CiAgICA8cmRmOlNlcT4KICAgICA8cmRmOmxpCiAgICAgIHN0RXZ0OmFjdGlvbj0icHJvZHVjZWQiCiAgICAgIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFmZmluaXR5IFBob3RvIDIgMi4xLjEiCiAgICAgIHN0RXZ0OndoZW49IjIwMjMtMDctMDNUMTQ6MTE6NDAtMDY6MDAiLz4KICAgIDwvcmRmOlNlcT4KICAgPC94bXBNTTpIaXN0b3J5PgogIDwvcmRmOkRlc2NyaXB0aW9uPgogPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KPD94cGFja2V0IGVuZD0iciI/PohIZ3IAAAGBaUNDUHNSR0IgSUVDNjE5NjYtMi4xAAAokXWRuUtDQRCHvyRKxIMIEbGwCKJWRmKUoI1FgheoRRLBq0leLiHH470ECbaCraAg2ngV+hdoK1gLgqIIYqu1oo2G57xEiIiZZXa+/e3OsDsL1nBayeh1Hshk81pwwu+aX1h02Z+xY8PJEO0RRVdnQuNhatrHHRYz3rjNWrXP/WtNsbiugKVBeFRRtbzwpPD0al41eVu4TUlFYsKnwn2aXFD41tSjFX4xOVnhL5O1cDAA1lZhV/IXR3+xktIywvJyujPpgvJzH/MlzfHsXEhil3gnOkEm8ONiijEC+BhgRGYfbrz0y4oa+Z5y/iw5yVVkVimisUKSFHn6RC1I9bjEhOhxGWmKZv//9lVPDHor1Zv9UP9kGG89YN+C0qZhfB4aRukIbI9wka3m5w5g+F30zarWvQ+OdTi7rGrRHTjfgI4HNaJFypJN3JpIwOsJtCyA8xoalyo9+9nn+B7Ca/JVV7C7B71y3rH8DXjLZ+43iMieAAAACXBIWXMAAAsTAAALEwEAmpwYAAABAklEQVQ4je3VQUrDQBTG8V9jsvMSAYt1aXfWE3gL915AdCdYFx5CPYUn0IKgrqVCriC6NKQuZoJtkCatS/1gmAzD++fNm5lvehaVYx9bSCxXhVfcoWhOZrhAidmKrYyxGaQReIZjfOAaz/hsyTDDLg5j7Awn9TJLvGO7BfKTBjGREnkq1GwjZvYSxwcdYbdCDW9whFEqbABhmbCH047Atwh8jON+4ns322q2THVs0nY0VtY/8K8Aq/id/YJTx1apYEGEi36FCc47giaxH8Z+yqI5DNbIbkfDHApcChb0IFz0J93sayjY16bgicX85Nj6BjuODL3GX3OM0NftCZjifj6zL9t8TyFzA/CyAAAAAElFTkSuQmCC";  acc_check.classList.replace("noCheck", "check");  accessory_name_span.title="Remove " + i.textContent;  } else {  i.classList.remove("tableSelected");  acc_check.src= "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAFEmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgeG1wOkNyZWF0ZURhdGU9IjIwMjMtMDctMDNUMTM6NTI6NDItMDYwMCIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjMtMDctMDNUMTM6NTU6MzgtMDY6MDAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjMtMDctMDNUMTM6NTU6MzgtMDY6MDAiCiAgIHBob3Rvc2hvcDpEYXRlQ3JlYXRlZD0iMjAyMy0wNy0wM1QxMzo1Mjo0Mi0wNjAwIgogICBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIgogICBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiCiAgIGV4aWY6UGl4ZWxYRGltZW5zaW9uPSIyMCIKICAgZXhpZjpQaXhlbFlEaW1lbnNpb249IjIwIgogICBleGlmOkNvbG9yU3BhY2U9IjEiCiAgIHRpZmY6SW1hZ2VXaWR0aD0iMjAiCiAgIHRpZmY6SW1hZ2VMZW5ndGg9IjIwIgogICB0aWZmOlJlc29sdXRpb25Vbml0PSIyIgogICB0aWZmOlhSZXNvbHV0aW9uPSI3Mi8xIgogICB0aWZmOllSZXNvbHV0aW9uPSI3Mi8xIj4KICAgPHhtcE1NOkhpc3Rvcnk+CiAgICA8cmRmOlNlcT4KICAgICA8cmRmOmxpCiAgICAgIHN0RXZ0OmFjdGlvbj0icHJvZHVjZWQiCiAgICAgIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFmZmluaXR5IFBob3RvIDIgMi4xLjEiCiAgICAgIHN0RXZ0OndoZW49IjIwMjMtMDctMDNUMTM6NTU6MzgtMDY6MDAiLz4KICAgIDwvcmRmOlNlcT4KICAgPC94bXBNTTpIaXN0b3J5PgogIDwvcmRmOkRlc2NyaXB0aW9uPgogPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KPD94cGFja2V0IGVuZD0iciI/PsqWhVcAAAGBaUNDUHNSR0IgSUVDNjE5NjYtMi4xAAAokXWRuUtDQRCHvyRKxIMIEbGwCKJWRmKUoI1FgheoRRLBq0leLiHH470ECbaCraAg2ngV+hdoK1gLgqIIYqu1oo2G57xEiIiZZXa+/e3OsDsL1nBayeh1Hshk81pwwu+aX1h02Z+xY8PJEO0RRVdnQuNhatrHHRYz3rjNWrXP/WtNsbiugKVBeFRRtbzwpPD0al41eVu4TUlFYsKnwn2aXFD41tSjFX4xOVnhL5O1cDAA1lZhV/IXR3+xktIywvJyujPpgvJzH/MlzfHsXEhil3gnOkEm8ONiijEC+BhgRGYfbrz0y4oa+Z5y/iw5yVVkVimisUKSFHn6RC1I9bjEhOhxGWmKZv//9lVPDHor1Zv9UP9kGG89YN+C0qZhfB4aRukIbI9wka3m5w5g+F30zarWvQ+OdTi7rGrRHTjfgI4HNaJFypJN3JpIwOsJtCyA8xoalyo9+9nn+B7Ca/JVV7C7B71y3rH8DXjLZ+43iMieAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA7ElEQVQ4je3VP0oDQRTH8U/GbOclFgzG0pTxMh5DLC1i4SX0MFoImlaJkDto6bKxeLO4CZJN1lJ/MMzA8H7z3vz5zsC6SpzhCMl21XjDPZabkwWuUWG1Z6tybAHDbHiFC3zgFnN8dmRY4BTnOXaFy6bMCu847jD5SeOcSIUyiT07yJm99jB8wV32mCZxAESZffWU+1HyfZpde7ZNTWzquhp769/wrxjWeVz8wqeJrZNAEPHQ+2qS+wXrcBj3MDvRgsNQwPFGIOhRPPRnu+FrIvB1KJi4bE/O9AfsLHsYbKxaYoqR3b6ABR7amX0BUYVIcK45KfQAAAAASUVORK5CYII=";  acc_check.classList.replace("check", "noCheck");  accessory_name_span.title="Add " + i.textContent;  }  }  setupAccessoryView(outfit, true);  }  function shouldOffAccessoryNotBeDisplayed(accessory_object, indexOfOutfit) {  if (!accessory_object.path.includes("/off.")) {  return false;  }  if (names_of_accessories_on.includes(accessory_object.name)) {  on_accessory=references_to_accessories_on.filter((item) =>  item.startsWith(accessory_object.name)  )[0];  for (var i of character.poses[selectedPose].outfits[indexOfOutfit].on_accessories) {  if (on_accessory==properAccessoryName(i)) {  return true;  }  }  }  return false;  }  function setupAccessoryView(outfit=undefined, clearBefore=false) {  var i;  if (outfit==undefined) {  outfit=character.poses[selectedPose].default_outfit;  }  if (clearBefore) {  document.querySelector("#topLevelAccess").remove();  }  indexOfOutfit=getIndexOfOutfit(outfit, character.poses[selectedPose].outfits);  out_start=character.poses[selectedPose].outfit_path;  accessChar=document.createElement("div");  accessChar.id="topLevelAccess";  accessChar.style.width=character.poses[selectedPose].max_accessory_outfit_width + "px";  accessChar.classList.add("characterAccess");  z_index_count=0;  for (i of getLayeringOrderWithAccessories(out_start, outfit, character.poses[selectedPose].outfits)) {  img=document.createElement("img");  if (i instanceof Object) {  if (shouldOffAccessoryNotBeDisplayed(i, indexOfOutfit)) {  continue;  }  image_path=i.path;  img.style.height=i.access_height + "px";  img.classList.add("characterImagesAccessory");  } else {  image_path=i;  img.classList.add("characterImagesOutfitAccessoryViews");  img.id="AccessoryBuilderOutfit";  img.name=outfit;  }  img.style.zIndex=z_index_count;  img.src=makeUrlCompatible(image_path);  img.alt=image_path.split("/").pop().split(".")[0];  accessChar.appendChild(img);  z_index_count++;  }  document.querySelector("#accessoryBuilder").append(accessChar);  namesDiv.style.height=AccessoryBuilderOutfit.scrollHeight + "px";  }  function swapHideDivDisplay(swap_to_number_string, first_time=false) {  if (swap_to_number_string==undefined) {  swap_to_number_string=sessionStorage.getItem("outfitOrAccessory");  swap_to_number_string=swap_to_number_string=="0" ? "1" : "0";  }  if (parseTextBool(sessionStorage.getItem("areOutfitsHidden")) && !first_time) {  } else if (swap_to_number_string=="0") {  imageList.classList.remove("hidden");  accessoryBuilder.classList.add("hidden");  sessionStorage.setItem("outfitOrAccessory", "0");  } else {  imageList.classList.add("hidden");  accessoryBuilder.classList.remove("hidden");  sessionStorage.setItem("outfitOrAccessory", "1");  }  if (!outfitsSelect.classList.contains("disallowHover") || first_time) {  hideDivSelectionButtonsFixFormatting(swap_to_number_string);  }  calculateImageListMaxHeight();  }  function hideDivSelectionButtonsFixFormatting(swap_to_number_string) {  if (swap_to_number_string=="0") {  outfitsSelect.classList.replace(  "hideDivSelectionButtonsAllowHover",  "hideDivSelectionButtonsUnderline"  );  outfitsSelect.title="";  accessorySelect.classList.replace(  "hideDivSelectionButtonsUnderline",  "hideDivSelectionButtonsAllowHover"  );  accessorySelect.title="Show accessories";  } else {  outfitsSelect.classList.replace(  "hideDivSelectionButtonsUnderline",  "hideDivSelectionButtonsAllowHover"  );  outfitsSelect.title="Show outfits";  accessorySelect.classList.replace(  "hideDivSelectionButtonsAllowHover",  "hideDivSelectionButtonsUnderline"  );  accessorySelect.title="";  }  }  function getProperOutfitName(outfit_path) {  span_name=outfit_path.split("/");  return span_name.length > 1 ? span_name[0] : span_name[0].split(".")[0];  }  function minusPoseFilter(remove_filter=false) {  old_pose_filter=pose_filter;  pose_filter=pose_filter - 1 < 1 ? 1 : pose_filter - 1;  if (remove_filter) {  pose_filter=1;  }  newURL.searchParams.set("p_count", pose_filter);  if (old_pose_filter==pose_filter) {  return;  } else if (title.textContent==scenario) {  window.location.href=newURL.toString();  } else {  replaceUrl=new URL(window.location.href);  if (static_url_addons.includes("p_count")) {  static_url_addons=static_url_addons.replace(  "p_count=" + old_pose_filter,  "p_count=" + pose_filter  );  } else {  static_url_addons=static_url_addons + "&p_count=" + pose_filter;  }  replaceUrl.searchParams.set("p_count", pose_filter);  window.history.replaceState(scenario, scenario, replaceUrl.toString());  }  }  function addPoseFilter() {  old_pose_filter=pose_filter;  pose_filter=pose_filter + 1 > max_poses ? max_poses : pose_filter + 1;  newURL.searchParams.set("p_count", pose_filter);  if (old_pose_filter==pose_filter) {  return;  } else if (title.textContent==scenario) {  window.location.href=newURL.toString();  } else {  replaceUrl=new URL(window.location.href);  if (static_url_addons.includes("p_count")) {  static_url_addons=static_url_addons.replace(  "p_count=" + old_pose_filter,  "p_count=" + pose_filter  );  } else {  static_url_addons=static_url_addons + "&p_count=" + pose_filter;  }  replaceUrl.searchParams.set("p_count", pose_filter);  window.history.replaceState(scenario, scenario, replaceUrl.toString());  }  }  function createExpressionSheet(images, addText="") {  const image_padding=10;  const skip_num=default_outfit.length;  var left_crop=character.poses[selectedPose].default_left_crop;  var right_crop=character.poses[selectedPose].default_right_crop;  var top_crop=character.poses[selectedPose].default_top_crop;  var n_height=parseInt(character.poses[selectedPose].max_face_height - top_crop + rect_height);  var n_width=right_crop - left_crop;  var imList=document.querySelector("#imageList2");  if (localStorage.getItem("darkMode")==1) {  face_name_fill=RGBAtoRGB(darkBackground);  } else {  face_name_fill=RGBAtoRGB(  window.getComputedStyle(document.body, null).getPropertyValue("background-color")  );  }  canvasTextFill="Black";  for (const [index, element] of enumerate(Object.values(images))) {  if (index < skip_num) {  continue;  }  txt_str=selectedPose + "_" + element.src.split("/").pop().split(".")[0].replace("%23", "#");  if (addText.length != 0) {  txt_str += " " + addText;  }  newCanvas=document.createElement("canvas");  newCanvas.id=txt_str;  newCanvas.height=n_height + image_padding;  newCanvas.width=n_width;  newCanvas.classList.add("faceCanvas");  context=newCanvas.getContext("2d");  imList.append(newCanvas);  if (index % 2==1) {  context.fillStyle="Black"; /*Color1 replace*/  } else {  context.fillStyle="#121212"; /*Color2 replace*/  }  context.fillRect(0, 0, n_width, n_height + image_padding);  for (var i=0; i < skip_num; i++) {  context.drawImage(images[i], left_crop, top_crop, n_width, n_height, 0, 0, n_width, n_height);  }  context.drawImage(images[index], left_crop, top_crop, n_width, n_height, 0, 0, n_width, n_height);  context.font="24pt Calibri";  context.fillStyle=face_name_fill;  /*rect color*/ context.fillRect(  0,  0 + n_height - rect_height,  n_width,  rect_height + image_padding  );  context.fillStyle=canvasTextFill;  /*text color*/ context.fillText(  txt_str,  (n_width - getTextWidth(txt_str, context.font)) / 2 + 0,  0 + n_height - (rect_height - image_padding) / 2 / 2  );  }  }  function changeFaces(currentFacesShowing, first_run=false) {  /*We have to track first run because we need to force the faces to be loaded*/ if (  character.poses[selectedPose].blushes.length==0 &&  !first_run  ) {  /*If we have no blushes and it's not the first run, just return the blushes*/ return currentFacesShowing;  }  if (currentFacesShowing=="f" && !first_run) {  /*Show blush faces*/ currentFacesShowing="b";  layerInOrder=default_outfit.concat(character.poses[selectedPose].blushes);  document.getElementById("imageList2").textContent="";  document.getElementById("imageList2").title="Click to show normal faces";  loadImages(layerInOrder, function (k) {  createExpressionSheet(k, (addText="blush"));  });  } else {  /*Show normal faces*/ currentFacesShowing="f";  layerInOrder=default_outfit.concat(character.poses[selectedPose].faces);  document.getElementById("imageList2").textContent="";  if (character.poses[selectedPose].blushes.length != 0) {  document.querySelector("#imageList2").classList.add("blushHover");  document.getElementById("imageList2").title="Click to show blush faces";  }  loadImages(layerInOrder, createExpressionSheet);  }  return currentFacesShowing;  }  function fixInfoMessage(mode_select) {  localStorage.setItem("intro", "1");  if (mode_select==0) {  localStorage.setItem("darkMode", "0");  } else {  localStorage.setItem("darkMode", "1");  }  favDialog.onclick="event.target==this && this.close()";  location.reload();  }  function toggleSearchBar(forceTitle=false) {  var switchToTitle=document.getElementById("titleSection").classList.contains("displayHidden");  if (switchToTitle || forceTitle) {  if (switchToTitle) {  window.scrollTo({ top: 0, behavior: "smooth" });  }  document.getElementById("titleSection").classList.remove("displayHidden");  document.getElementById("searchSection").classList.add("displayHidden");  document.getElementById("searchBar").value="";  document.getElementById("searchBar").disabled=true;  updateResults();  } else {  window.scrollTo({ top: 0, behavior: "smooth" });  document.getElementById("titleSection").classList.add("displayHidden");  document.getElementById("searchSection").classList.remove("displayHidden");  document.getElementById("searchBar").disabled=false;  document.getElementById("searchBar").focus({ preventScroll: true });  }  }  function filterListAndRemovePrefix(filterWords, prefix) {  var prefix_list=filterWords.filter((x) => x.startsWith(prefix));  /*We have to splice because it keeps the reference to the original array*/ filterWords.splice(  0,  filterWords.length,  ...filterWords.filter((x) => !prefix_list.includes(x))  );  return prefix_list.filter((x) => x != prefix).map((x) => x.substring(1));  }  function updateResults() {  var filterWords=document.getElementById("searchBar").value.toLowerCase().split(/\s+/);  var pose_filter, outfitFilter, namesFilter, accessoryFilter, faceFilter;  pose_filter=filterListAndRemovePrefix(filterWords, "!");  outfitFilter=filterListAndRemovePrefix(filterWords, "#");  namesFilter=filterListAndRemovePrefix(filterWords, "&");  accessoryFilter=filterListAndRemovePrefix(filterWords, "*");  faceFilter=filterListAndRemovePrefix(filterWords, ">");  var characterSearchString, poseString, charName, outfitString, accessoryString, numberOfFacesInPoses;  for (const element of document.getElementsByClassName("character")) {  if (outfit_filter) {  charName=element.name;  poseString=element.pose;  outfitString=jsonData[charName].poses[poseString].outfits  .map((x) => x.path.split("/")[0].split(".")[0])  .join(" ");  accessoryString=jsonData[charName].poses[poseString].accessory_names  .map((x) => x.name + x.state)  .join(" ");  numberOfFacesInPoses=[jsonData[charName].poses[poseString].faces.length];  } else {  charName=element.getElementsByTagName("span")[0].textContent;  var poseElements=[...element.getElementsByClassName("outerDiv")].map((x) => x.pose);  poseString=poseElements.join(" ");  outfitString="";  accessoryString="";  numberOfFacesInPoses=[];  for (const pose of poseElements) {  outfitString += jsonData[charName].poses[pose].outfits  .map((x) => x.path.split("/")[0].split(".")[0])  .join(" ");  accessoryString += jsonData[charName].poses[pose].accessory_names  .map((x) => x.name + x.state)  .join(" ");  numberOfFacesInPoses.push(jsonData[charName].poses[pose].faces.length);  }  }  charName=charName.toLowerCase();  poseString=poseString.toLowerCase();  outfitString=outfitString.toLowerCase();  accessoryString=accessoryString.toLowerCase();  /*We add a space cause we don't want false includes*/ characterSearchString=charName;  characterSearchString += " " + poseString;  characterSearchString += " " + outfitString;  characterSearchString += " " + accessoryString;  if (  filterWords.every((x) => characterSearchString.includes(x)) &&  namesFilter.every((x) => charName.includes(x)) &&  pose_filter.every((x) => poseString.includes(x)) &&  outfitFilter.every((x) => outfitString.includes(x)) &&  accessoryFilter.every((x) => accessoryString.includes(x)) &&  (faceFilter.length==0 || faceFilter.some((x) => numberOfFacesInPoses.some((y) => y >= x)))  ) {  element.classList.remove("displayHidden");  } else {  element.classList.add("displayHidden");  }  }  }  function toggleDarkMode() {  if (document.querySelector("#WelcomeDialog")==undefined) {  if (localStorage.getItem("darkMode")=="0") {  localStorage.setItem("darkMode", "1");  } else {  localStorage.setItem("darkMode", "0");  }  location.reload();  }  }  function toggleKeyboardShortcuts() {  disable_keys=!disable_keys;  localStorage.setItem("disable_keys", disable_keys);  document.getAnimations().forEach((animation) => {  animation.cancel();  });  document.querySelector("#ToggleText").textContent=disable_keys  ? "Keyboard shortcuts are disabled."  : "Keyboard shortcuts are enabled.";  setTimeout(function () {  document.querySelector("#ToggleText").classList.add("fade");  }, 6.25);  document.querySelector("#ToggleText").classList.remove("fade");  }  var disable_keys=parseTextBool(localStorage.getItem("disable_keys"));  if (disable_keys==false) {  localStorage.setItem("disable_keys", false);  disable_keys=false;  }  if (localStorage.getItem("darkMode")==undefined) {  localStorage.setItem("darkMode", "0");  } else if (localStorage.getItem("darkMode")==1) {  document.querySelector("body").style.backgroundColor=darkBackground;  }  document.querySelector("#ToggleText").textContent=disable_keys  ? "Keyboard shortcuts are disabled."  : "Keyboard shortcuts are enabled.";  scenario="'''
# Add scenario title, '"; ", then add the "json" with "var jsonData={ " at start with "};" at the end
HTML_SNIP3 = r""" /*Start*/ var characterArray=[];  for (var char of Object.keys(jsonData)) {  total_poses=Object.keys(jsonData[char].poses).length;  for (var current_pose of Object.keys(jsonData[char].poses)) {  characterArray.push([char, current_pose, total_poses]);  }  }  indexLen=characterArray.length - 1;  /*Parser gets mad when no text is present, so we have to have text in H1 then remove them later*/ titleExtra.textContent= "";  file_name=location.pathname.split("/").pop() || ".";  var max_poses=Math.max(...characterArray.map((o) => o[2]));  var static_url_addons="";  function* enumerate(it, start=0) {  let i=start;  for (const x of it) yield [i++, x];  }  const urlParams=new URLSearchParams(window.location.search);  var newURL=new URL(location.protocol + "//" + location.host + location.pathname);  var homeURL=new URL(location.protocol + "//" + location.host + location.pathname);  var pose_filter= urlParams.get("p_count") && /^\d+$/.test(urlParams.get("p_count"))  ? parseInt(urlParams.get("p_count"))  : 1;  if (pose_filter > max_poses) {  pose_filter=max_poses;  }  var outfit_filter=urlParams.get("outfitView") && /^[1]$/.test(urlParams.get("outfitView")) ? true : false;  if (outfit_filter) {  newURL.searchParams.set("outfitView", "1");  homeURL.searchParams.set("outfitView", "1");  document.getElementById("imageList").classList.replace("charactersWrap", "charactersRow");  scenario += " Outfit View";  }  if (pose_filter > 1) {  newURL.searchParams.set("p_count", pose_filter);  homeURL.searchParams.set("p_count", pose_filter);  }  var selectedCharacter=urlParams.get("character") ? urlParams.get("character") : undefined;  var selectedPose=urlParams.get("pose") ? urlParams.get("pose") : undefined;  hide_outfits=urlParams.get("hideextrainfo") != null;  /*If true, we hide the extra info*/ if (selectedCharacter==undefined || selectedPose==undefined) {  selectedCharacter=undefined;  selectedPose=undefined;  } else if (  selectedCharacter != undefined &&  (!(selectedCharacter in jsonData) || !(selectedPose in jsonData[selectedCharacter].poses))  ) {  selectedCharacter=undefined;  selectedPose=undefined;  } else {  newURL.searchParams.set("character", selectedCharacter);  newURL.searchParams.set("pose", selectedPose);  }  window.history.replaceState(scenario, scenario, newURL.toString());  var rect_height=32;  var newVersion=1;  if (localStorage.getItem("versionKey") != newVersion) {  localStorage.setItem("versionKey", newVersion);  localStorage.setItem("intro", 0);  }  if (localStorage.getItem("intro")==1) {  /* 1 is seen, other is not seen */ WelcomeDialog.remove();  } else {  HelpDialog.style.display="none";  WelcomeTitle.textContent=scenario + " Sprite Viewer";  favDialog.onclick=null;  lightMode.onclick=function () {  fixInfoMessage(0);  };  darkMode.onclick=function () {  fixInfoMessage(1);  };  popOutHelp();  }  if (localStorage.getItem("intro")==null) {  } else if (selectedCharacter==undefined) {  rightButton.title="Show characters with " + (pose_filter + 1) + " or more poses";  rightButton.src= "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAMAAAANIilAAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAGUExURQAAAAAAAKVnuc8AAAACdFJOU/8A5bcwSgAAAAlwSFlzAAAOwwAADsMBx2+oZAAAAFdJREFUSEvt0jEKACAQA0Hv/582xSKBYGllpsyx3a25WQdDauwohSE1dpTCkBo7SmFIjR2lMKQv46q3+LTEXRhSY0cpDKmxoxSG1NhRCkNq7CiFIf0Xz2zhbwnFW3CzDgAAAABJRU5ErkJggg==";  rightButton.addEventListener("click", function () {  addPoseFilter();  });  if (pose_filter==max_poses) {  rightButton.style.display="none";  }  if (pose_filter==1) {  leftButton.style.display="none";  } else {  titleExtra.textContent="(" + pose_filter + " or more poses)";  titleExtra.title="Remove pose filter";  titleExtra.onclick=function () {  minusPoseFilter(true);  };  leftButton.title="Show characters with " + (pose_filter - 1) + " or more poses";  leftButton.src= "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAABOSURBVGhD7duxDcBACARB+P57xg6+CPuYkRDxpkj0zNQm5+41BKcTDAAAAAAf1++susS7WqYTnE5wOsHp1gUDAAAA8Hu+WtIJTic4W9UDQ40HI5mViLUAAAAASUVORK5CYII=";  leftButton.onclick=function () {  minusPoseFilter();  };  }  document.querySelector("#title").addEventListener("click", function () {  document.querySelector("body").dispatchEvent(new KeyboardEvent("keydown", { code: "KeyO" }));  });  if (outfit_filter) {  document.querySelector("#title").title="Swap to regular view";  } else {  document.querySelector("#title").title="Swap to outfit view";  }  document.querySelector("#hideButton").remove();  document.querySelector("#backButton").remove();  document.querySelector("#selectionButtonDiv").remove();  title.textContent=scenario;  var url2=new URL(newURL.toString());  Object.entries(jsonData).forEach(([character, characterData]) => {  if (pose_filter > 1 && Object.keys(characterData.poses).length < pose_filter) {  return;  }  url2.searchParams.set("character", character);  if (outfit_filter) {  Object.entries(characterData.poses).forEach(([pose, poseData]) => {  var outfits=poseData.outfits.map((outfit) => [  outfit.path,  outfit.path.split("/").pop(),  outfit.off_accessories,  ]);  url2.searchParams.set("pose", pose);  characterDiv=document.createElement("a");  characterDiv.classList.add("character");  characterDiv.title="View character sheet for " + character + "_" + pose;  characterDiv.href=url2.toString();  span=document.createElement("span");  span.classList.add("characterNameSpan");  span.textContent=character + "_" + pose;  characterDiv.name=character;  characterDiv.pose=pose;  characterDiv.appendChild(span);  for (const outfit of outfits) {  charLink=document.createElement("a");  characterDiv.appendChild(charLink);  outerDiv=document.createElement("div");  outerDiv.classList.add("outerDiv");  charLink.appendChild(outerDiv);  var default_outfit=getLayeringOrderOutfits(  poseData.outfit_path,  outfit[0],  outfit[2]  );  for (var i of default_outfit) {  img=document.createElement("img");  var image_path;  if (Array.isArray(i)) {  image_path=i[0];  img.style.height=i[1] + "px";  img.classList.add("characterImagesAccessory");  } else {  image_path=i;  img.classList.add("characterImagesOutfitMainViews");  }  img.src=makeUrlCompatible(image_path);  img.alt=image_path.split("/")[0].split(".")[0];  outerDiv.appendChild(img);  }  nameDiv=document.createElement("div");  nameDiv.classList.add("characterPoseName");  nameDiv.textContent=getProperOutfitName(outfit[0]);  outerDiv.appendChild(nameDiv);  }  characterDiv.addEventListener("mouseenter", function (evt) {  changeToFaceNumberingOutfit(this);  });  characterDiv.addEventListener("mouseleave", function (evt) {  changeToPoseOutfit(this);  });  document.querySelector("#imageList").append(characterDiv);  });  } else {  characterDiv=document.createElement("div");  characterDiv.classList.add("character");  span=document.createElement("span");  span.textContent=character;  characterDiv.appendChild(span);  Object.entries(characterData.poses).forEach(([pose, poseData]) => {  url2.searchParams.set("pose", pose);  var default_outfit=getLayeringOrder(  poseData.outfit_path,  poseData.default_outfit,  poseData.default_accessories  );  charLink=document.createElement("a");  charLink.href=url2.toString();  charLink.classList.add("mainPageHoverLink");  charLink.title="View character sheet for " + character + "_" + pose;  characterDiv.appendChild(charLink);  outerDiv=document.createElement("div");  outerDiv.classList.add("outerDiv");  charLink.appendChild(outerDiv);  for (var i of default_outfit) {  img=document.createElement("img");  var image_path;  if (Array.isArray(i)) {  image_path=i[0];  img.style.height=i[1] + "px";  img.classList.add("characterImagesAccessory");  } else {  image_path=i;  img.classList.add("characterImagesOutfitMainViews");  }  img.src=makeUrlCompatible(image_path);  img.alt=image_path.split("/")[1].split(".")[0];  outerDiv.appendChild(img);  }  nameDiv=document.createElement("div");  nameDiv.classList.add("characterPoseName");  nameDiv.textContent=pose;  outerDiv.name=character;  outerDiv.pose=pose;  outerDiv.addEventListener("mouseenter", function (evt) {  changeToFaceNumberingDefault(this);  });  outerDiv.addEventListener("mouseleave", function (evt) {  changeToPoseDefault(this);  });  outerDiv.appendChild(nameDiv);  });  document.querySelector("#imageList").appendChild(characterDiv);  }  });  } else {  var currentFacesShowing="f";  leftButton.title="Switch to " + getTitleForMinusCharacter();  rightButton.title="Switch to " + getTitleForAddCharacter();  title.classList.add("selectedCharacter");  document.querySelector("#toggleFind").remove();  leftButton.addEventListener("click", function () {  switchCharactersMinus();  });  rightButton.addEventListener("click", function () {  switchCharactersAdd();  });  document.querySelector("#imageList2").addEventListener("click", function () {  document.querySelector("body").dispatchEvent(new KeyboardEvent("keydown", { code: "KeyB" }));  });  console.log(hide_outfits);  hide_outfits=hide_outfits || parseTextBool(sessionStorage.getItem("areOutfitsHidden"));  outfits_or_accessories=sessionStorage.getItem("outfitOrAccessory");  if (outfits_or_accessories==undefined) {  sessionStorage.setItem("outfitOrAccessory", "0");  /*0 is show outfits, 1 is show access*/ outfits_or_accessories="0";  }  title.textContent=selectedCharacter + "_" + selectedPose;  var character=jsonData[selectedCharacter];  const out_start=character.poses[selectedPose].outfit_path;  hideButton.addEventListener("click", function () {  manipulateImageList();  });  document.querySelector("#backButton").href=homeURL.toString();  characterContainer=document.createElement("div");  characterContainer.classList.add("character2Container");  let outfits=Object.keys(character.poses[selectedPose].outfits);  Object.entries(character.poses[selectedPose].outfits).forEach(([index, outfit]) => {  var default_outfit=getLayeringOrderOutfits(out_start, outfit.path, outfit.off_accessories);  var char2=document.createElement("div");  char2.classList.add("character2");  for (var i of default_outfit) {  img=document.createElement("img");  var image_path;  if (Array.isArray(i)) {  image_path=i[0];  img.style.height=i[1] + "px";  img.classList.add("characterImagesAccessory");  } else {  image_path=i;  img.classList.add("characterImagesOutfitMainViews");  }  img.src=makeUrlCompatible(image_path);  img.alt=image_path.split("/")[0].split(".")[0];  char2.appendChild(img);  }  span_name=outfit.path.split("/");  span_name=getProperOutfitName(outfit.path);  outName=document.createElement("span");  outName.textContent=span_name;  char2.appendChild(outName);  characterContainer.appendChild(char2);  });  document.querySelector("#imageList").append(characterContainer);  var default_outfit=getLayeringOrderFlat(  out_start,  character.poses[selectedPose].default_outfit,  character.poses[selectedPose].default_accessories  );  namesDiv=document.createElement("div");  namesDiv.classList.add("characterAccessList");  namesDiv.classList.add("accessoryElementSelection");  namesDiv.id="namesDiv";  names_of_accessories_on=[];  references_to_accessories_on=[];  non_face_accessories_to_add=[];  outfitHeader=document.createElement("span");  outfitHeader.classList.add("elementHeaderLineOutfit");  outfitHeader.textContent="Outfits";  outfitHeader.title="Change outfits";  namesDiv.append(outfitHeader);  for (var i of character.poses[selectedPose].outfits) {  outfitDiv=document.createElement("div");  outfitSpan=document.createElement("span");  outfitDiv.classList.add("elementTableLine");  outfitDiv.classList.add("outfitLine");  outfitSpan.classList.add("alignMiddle");  span_name=getProperOutfitName(i.path);  outfitSpan.textContent=span_name;  outfitDiv.title="Show outfit " + span_name;  outfitDiv.name=i.path;  outfitDiv.addEventListener("click", function () {  changeAccessoryOutfit(this);  });  select_square=document.createElement("img");  select_square.src= "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAFEmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgeG1wOkNyZWF0ZURhdGU9IjIwMjMtMDctMDNUMTM6NTI6NDItMDYwMCIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjMtMDctMDNUMTM6NTU6MzgtMDY6MDAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjMtMDctMDNUMTM6NTU6MzgtMDY6MDAiCiAgIHBob3Rvc2hvcDpEYXRlQ3JlYXRlZD0iMjAyMy0wNy0wM1QxMzo1Mjo0Mi0wNjAwIgogICBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIgogICBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiCiAgIGV4aWY6UGl4ZWxYRGltZW5zaW9uPSIyMCIKICAgZXhpZjpQaXhlbFlEaW1lbnNpb249IjIwIgogICBleGlmOkNvbG9yU3BhY2U9IjEiCiAgIHRpZmY6SW1hZ2VXaWR0aD0iMjAiCiAgIHRpZmY6SW1hZ2VMZW5ndGg9IjIwIgogICB0aWZmOlJlc29sdXRpb25Vbml0PSIyIgogICB0aWZmOlhSZXNvbHV0aW9uPSI3Mi8xIgogICB0aWZmOllSZXNvbHV0aW9uPSI3Mi8xIj4KICAgPHhtcE1NOkhpc3Rvcnk+CiAgICA8cmRmOlNlcT4KICAgICA8cmRmOmxpCiAgICAgIHN0RXZ0OmFjdGlvbj0icHJvZHVjZWQiCiAgICAgIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFmZmluaXR5IFBob3RvIDIgMi4xLjEiCiAgICAgIHN0RXZ0OndoZW49IjIwMjMtMDctMDNUMTM6NTU6MzgtMDY6MDAiLz4KICAgIDwvcmRmOlNlcT4KICAgPC94bXBNTTpIaXN0b3J5PgogIDwvcmRmOkRlc2NyaXB0aW9uPgogPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KPD94cGFja2V0IGVuZD0iciI/PsqWhVcAAAGBaUNDUHNSR0IgSUVDNjE5NjYtMi4xAAAokXWRuUtDQRCHvyRKxIMIEbGwCKJWRmKUoI1FgheoRRLBq0leLiHH470ECbaCraAg2ngV+hdoK1gLgqIIYqu1oo2G57xEiIiZZXa+/e3OsDsL1nBayeh1Hshk81pwwu+aX1h02Z+xY8PJEO0RRVdnQuNhatrHHRYz3rjNWrXP/WtNsbiugKVBeFRRtbzwpPD0al41eVu4TUlFYsKnwn2aXFD41tSjFX4xOVnhL5O1cDAA1lZhV/IXR3+xktIywvJyujPpgvJzH/MlzfHsXEhil3gnOkEm8ONiijEC+BhgRGYfbrz0y4oa+Z5y/iw5yVVkVimisUKSFHn6RC1I9bjEhOhxGWmKZv//9lVPDHor1Zv9UP9kGG89YN+C0qZhfB4aRukIbI9wka3m5w5g+F30zarWvQ+OdTi7rGrRHTjfgI4HNaJFypJN3JpIwOsJtCyA8xoalyo9+9nn+B7Ca/JVV7C7B71y3rH8DXjLZ+43iMieAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA7ElEQVQ4je3VP0oDQRTH8U/GbOclFgzG0pTxMh5DLC1i4SX0MFoImlaJkDto6bKxeLO4CZJN1lJ/MMzA8H7z3vz5zsC6SpzhCMl21XjDPZabkwWuUWG1Z6tybAHDbHiFC3zgFnN8dmRY4BTnOXaFy6bMCu847jD5SeOcSIUyiT07yJm99jB8wV32mCZxAESZffWU+1HyfZpde7ZNTWzquhp769/wrxjWeVz8wqeJrZNAEPHQ+2qS+wXrcBj3MDvRgsNQwPFGIOhRPPRnu+FrIvB1KJi4bE/O9AfsLHsYbKxaYoqR3b6ABR7amX0BUYVIcK45KfQAAAAASUVORK5CYII=";  select_square.alt="box";  select_square.classList.add("alignMiddleImg");  select_square.classList.add("noCheck");  if (character.poses[selectedPose].default_outfit==i.path) {  select_square.src= "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAFEmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgeG1wOkNyZWF0ZURhdGU9IjIwMjMtMDctMDNUMTM6NTI6NDItMDYwMCIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjMtMDctMDNUMTQ6MTE6NDAtMDY6MDAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjMtMDctMDNUMTQ6MTE6NDAtMDY6MDAiCiAgIHBob3Rvc2hvcDpEYXRlQ3JlYXRlZD0iMjAyMy0wNy0wM1QxMzo1Mjo0Mi0wNjAwIgogICBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIgogICBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiCiAgIGV4aWY6UGl4ZWxYRGltZW5zaW9uPSIyMCIKICAgZXhpZjpQaXhlbFlEaW1lbnNpb249IjIwIgogICBleGlmOkNvbG9yU3BhY2U9IjEiCiAgIHRpZmY6SW1hZ2VXaWR0aD0iMjAiCiAgIHRpZmY6SW1hZ2VMZW5ndGg9IjIwIgogICB0aWZmOlJlc29sdXRpb25Vbml0PSIyIgogICB0aWZmOlhSZXNvbHV0aW9uPSI3Mi8xIgogICB0aWZmOllSZXNvbHV0aW9uPSI3Mi8xIj4KICAgPHhtcE1NOkhpc3Rvcnk+CiAgICA8cmRmOlNlcT4KICAgICA8cmRmOmxpCiAgICAgIHN0RXZ0OmFjdGlvbj0icHJvZHVjZWQiCiAgICAgIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFmZmluaXR5IFBob3RvIDIgMi4xLjEiCiAgICAgIHN0RXZ0OndoZW49IjIwMjMtMDctMDNUMTQ6MTE6NDAtMDY6MDAiLz4KICAgIDwvcmRmOlNlcT4KICAgPC94bXBNTTpIaXN0b3J5PgogIDwvcmRmOkRlc2NyaXB0aW9uPgogPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KPD94cGFja2V0IGVuZD0iciI/PohIZ3IAAAGBaUNDUHNSR0IgSUVDNjE5NjYtMi4xAAAokXWRuUtDQRCHvyRKxIMIEbGwCKJWRmKUoI1FgheoRRLBq0leLiHH470ECbaCraAg2ngV+hdoK1gLgqIIYqu1oo2G57xEiIiZZXa+/e3OsDsL1nBayeh1Hshk81pwwu+aX1h02Z+xY8PJEO0RRVdnQuNhatrHHRYz3rjNWrXP/WtNsbiugKVBeFRRtbzwpPD0al41eVu4TUlFYsKnwn2aXFD41tSjFX4xOVnhL5O1cDAA1lZhV/IXR3+xktIywvJyujPpgvJzH/MlzfHsXEhil3gnOkEm8ONiijEC+BhgRGYfbrz0y4oa+Z5y/iw5yVVkVimisUKSFHn6RC1I9bjEhOhxGWmKZv//9lVPDHor1Zv9UP9kGG89YN+C0qZhfB4aRukIbI9wka3m5w5g+F30zarWvQ+OdTi7rGrRHTjfgI4HNaJFypJN3JpIwOsJtCyA8xoalyo9+9nn+B7Ca/JVV7C7B71y3rH8DXjLZ+43iMieAAAACXBIWXMAAAsTAAALEwEAmpwYAAABAklEQVQ4je3VQUrDQBTG8V9jsvMSAYt1aXfWE3gL915AdCdYFx5CPYUn0IKgrqVCriC6NKQuZoJtkCatS/1gmAzD++fNm5lvehaVYx9bSCxXhVfcoWhOZrhAidmKrYyxGaQReIZjfOAaz/hsyTDDLg5j7Awn9TJLvGO7BfKTBjGREnkq1GwjZvYSxwcdYbdCDW9whFEqbABhmbCH047Atwh8jON+4ns322q2THVs0nY0VtY/8K8Aq/id/YJTx1apYEGEi36FCc47giaxH8Z+yqI5DNbIbkfDHApcChb0IFz0J93sayjY16bgicX85Nj6BjuODL3GX3OM0NftCZjifj6zL9t8TyFzA/CyAAAAAElFTkSuQmCC";  outfitDiv.classList.add("tableSelected");  select_square.classList.replace("noCheck", "check");  outfitDiv.title="";  }  outfitDiv.append(select_square);  outfitDiv.append(outfitSpan);  namesDiv.append(outfitDiv);  }  if (character.poses[selectedPose].accessory_names.length > 0) {  accessHeader=document.createElement("span");  accessHeader.classList.add("elementHeaderLineAccessories");  accessHeader.textContent="Accessories";  accessHeader.title="Add or remove accessories";  namesDiv.append(accessHeader);  for (var i of character.poses[selectedPose].accessory_names) {  accDiv=document.createElement("div");  access=document.createElement("span");  accDiv.classList.add("elementTableLine");  accDiv.classList.add("accessoryLine");  access.textContent=properAccessoryName(i);  accDiv.title="Add " + access.textContent;  access.name=access.textContent;  access.classList.add("alignMiddle");  accDiv.setAttribute("accessoryName", i.name);  accDiv.setAttribute("accessoryState", i.state);  accDiv.setAttribute("is_face", i.is_face);  accDiv.onclick=function () {  manipulateAccessories(this);  };  select_square=document.createElement("img");  select_square.src= "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAFEmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgeG1wOkNyZWF0ZURhdGU9IjIwMjMtMDctMDNUMTM6NTI6NDItMDYwMCIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjMtMDctMDNUMTM6NTU6MzgtMDY6MDAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjMtMDctMDNUMTM6NTU6MzgtMDY6MDAiCiAgIHBob3Rvc2hvcDpEYXRlQ3JlYXRlZD0iMjAyMy0wNy0wM1QxMzo1Mjo0Mi0wNjAwIgogICBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIgogICBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiCiAgIGV4aWY6UGl4ZWxYRGltZW5zaW9uPSIyMCIKICAgZXhpZjpQaXhlbFlEaW1lbnNpb249IjIwIgogICBleGlmOkNvbG9yU3BhY2U9IjEiCiAgIHRpZmY6SW1hZ2VXaWR0aD0iMjAiCiAgIHRpZmY6SW1hZ2VMZW5ndGg9IjIwIgogICB0aWZmOlJlc29sdXRpb25Vbml0PSIyIgogICB0aWZmOlhSZXNvbHV0aW9uPSI3Mi8xIgogICB0aWZmOllSZXNvbHV0aW9uPSI3Mi8xIj4KICAgPHhtcE1NOkhpc3Rvcnk+CiAgICA8cmRmOlNlcT4KICAgICA8cmRmOmxpCiAgICAgIHN0RXZ0OmFjdGlvbj0icHJvZHVjZWQiCiAgICAgIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFmZmluaXR5IFBob3RvIDIgMi4xLjEiCiAgICAgIHN0RXZ0OndoZW49IjIwMjMtMDctMDNUMTM6NTU6MzgtMDY6MDAiLz4KICAgIDwvcmRmOlNlcT4KICAgPC94bXBNTTpIaXN0b3J5PgogIDwvcmRmOkRlc2NyaXB0aW9uPgogPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KPD94cGFja2V0IGVuZD0iciI/PsqWhVcAAAGBaUNDUHNSR0IgSUVDNjE5NjYtMi4xAAAokXWRuUtDQRCHvyRKxIMIEbGwCKJWRmKUoI1FgheoRRLBq0leLiHH470ECbaCraAg2ngV+hdoK1gLgqIIYqu1oo2G57xEiIiZZXa+/e3OsDsL1nBayeh1Hshk81pwwu+aX1h02Z+xY8PJEO0RRVdnQuNhatrHHRYz3rjNWrXP/WtNsbiugKVBeFRRtbzwpPD0al41eVu4TUlFYsKnwn2aXFD41tSjFX4xOVnhL5O1cDAA1lZhV/IXR3+xktIywvJyujPpgvJzH/MlzfHsXEhil3gnOkEm8ONiijEC+BhgRGYfbrz0y4oa+Z5y/iw5yVVkVimisUKSFHn6RC1I9bjEhOhxGWmKZv//9lVPDHor1Zv9UP9kGG89YN+C0qZhfB4aRukIbI9wka3m5w5g+F30zarWvQ+OdTi7rGrRHTjfgI4HNaJFypJN3JpIwOsJtCyA8xoalyo9+9nn+B7Ca/JVV7C7B71y3rH8DXjLZ+43iMieAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA7ElEQVQ4je3VP0oDQRTH8U/GbOclFgzG0pTxMh5DLC1i4SX0MFoImlaJkDto6bKxeLO4CZJN1lJ/MMzA8H7z3vz5zsC6SpzhCMl21XjDPZabkwWuUWG1Z6tybAHDbHiFC3zgFnN8dmRY4BTnOXaFy6bMCu847jD5SeOcSIUyiT07yJm99jB8wV32mCZxAESZffWU+1HyfZpde7ZNTWzquhp769/wrxjWeVz8wqeJrZNAEPHQ+2qS+wXrcBj3MDvRgsNQwPFGIOhRPPRnu+FrIvB1KJi4bE/O9AfsLHsYbKxaYoqR3b6ABR7amX0BUYVIcK45KfQAAAAASUVORK5CYII=";  select_square.alt="box";  select_square.classList.add("alignMiddleImg");  select_square.classList.add("noCheck");  accDiv.append(select_square);  accDiv.append(access);  namesDiv.append(accDiv);  }  }  document.querySelector("#accessoryBuilder").append(namesDiv);  setupAccessoryView();  changeFaces(currentFacesShowing, true);  document.title=prefix + "_" + selectedCharacter + "_" + selectedPose;  hideDiv.setAttribute("currentHeight", hideDiv.scrollHeight + "px");  hideDiv.style.maxHeight=hideDiv.scrollHeight + "px";  if (hide_outfits) {  sessionStorage.setItem("areOutfitsHidden", "true");  hideDiv.style.maxHeight="0px";  hideDiv.classList.add("hidden");  hideDiv.classList.remove("unhidden");  document.querySelector("#changeArrow").classList.remove("rotateUp");  document.querySelector("#changeArrow").classList.add("rotateDownNoAnimation");  document.querySelector("#changeArrow").title="Show accessories and Outfits";  outfitsSelect.classList.add("disallowHover");  accessorySelect.classList.add("disallowHover");  } else {  document.querySelector("#changeArrow").title="Hide accessories and Outfits";  }  window.addEventListener("resize", (event) => {  calculateImageListMaxHeight();  });  window.addEventListener("load", (event) => {  calculateImageListMaxHeight();  });  swapHideDivDisplay(outfits_or_accessories, true);  outfitsSelect.onclick=function () {  swapHideDivDisplay("0");  };  accessorySelect.onclick=function () {  swapHideDivDisplay("1");  };  }  /* Dark mode setting */ if (localStorage.getItem("darkMode")==1 && selectedCharacter != undefined) {  changeBox.classList.add("darkButton");  }  document.querySelector("body").addEventListener("keydown", (event) => {  var modifierKeyPressed=event.ctrlKey || event.altKey || event.shiftKey || event.metaKey;  if (  event.target==document.getElementById("searchBar") &&  !(event.code="KeyF" && event.ctrlKey) &&  event.code != "Escape"  ) {  return;  }  var replaceUrl;  if (event.code=="KeyF" && selectedCharacter==undefined) {  /*Control f twice should go Title -> search -> title */ toggleSearchBar();  event.preventDefault();  } else if (modifierKeyPressed) {  } else if (modifierKeyPressed) {  } else if (event.code=="Escape" && selectedCharacter==undefined) {  /*Escape should always toggle it back to title*/ toggleSearchBar(true);  } else if (event.code=="KeyD") {  toggleDarkMode();  } else if (event.code=="KeyI") {  if (document.querySelector("#WelcomeDialog") != undefined) {  } else if (  favDialog.open &&  !document.getElementById("HelpDialog").classList.contains("displayHidden")  ) {  favDialog.close();  } else {  popOutHelp();  }  } else if (event.code=="KeyS" && selectedCharacter==undefined) {  if (document.querySelector("#WelcomeDialog") != undefined) {  } else if (  favDialog.open &&  !document.getElementById("searchTips").classList.contains("displayHidden")  ) {  favDialog.close();  } else {  popOutTips();  }  } else if (event.code=="Backslash") {  toggleKeyboardShortcuts();  } else if (event.code=="KeyO" && selectedCharacter==undefined) {  old_outfit_filter=outfit_filter ? 1 : 0;  old_outfit_word=outfit_filter ? "On" : "Off";  outfit_filter=!outfit_filter;  new_outfit_filter=outfit_filter ? 1 : 0;  new_outfit_word=outfit_filter ? "On" : "Off";  newURL.searchParams.set("outfitView", new_outfit_filter);  if (title.textContent==scenario) {  window.location.href=newURL.toString();  } else {  replaceUrl=new URL(window.location.href);  if (static_url_addons.includes("outfitView")) {  static_url_addons=static_url_addons.replace(  "outfitView=" + old_outfit_filter,  "outfitView=" + new_outfit_filter  );  } else {  static_url_addons=static_url_addons + "&outfitView=" + new_outfit_filter;  }  replaceUrl.searchParams.set("outfitView", new_outfit_filter);  window.history.replaceState(scenario, scenario, replaceUrl.toString());  }  } else if (disable_keys) {  } else if (event.code=="KeyA" && selectedCharacter != undefined) {  swapHideDivDisplay();  } else if (event.code=="KeyH" && selectedCharacter != undefined) {  manipulateImageList();  } else if (event.code=="KeyB" && selectedCharacter != undefined) {  currentFacesShowing=changeFaces(currentFacesShowing);  } else if (event.key=="ArrowUp" && selectedCharacter != undefined) {  window.location.href=homeURL.toString();  } else if (event.key=="ArrowRight") {  switchCharactersAdd();  } else if (event.key=="ArrowLeft") {  switchCharactersMinus();  } else if (  (event.code=="Minus" || event.code=="NumpadSubtract") &&  selectedCharacter==undefined  ) {  minusPoseFilter();  } else if (event.code=="KeyC" && selectedCharacter==undefined) {  minusPoseFilter(true);  } else if ((event.code=="Equal" || event.code=="NumpadAdd") && selectedCharacter==undefined) {  addPoseFilter();  }  });  </script>  </body>  </html> """
init(convert=True)
html_snips = (HTML_SNIP1, HTML_SNIP2, HTML_SNIP3)


def main_loop(args: Namespace, yml: dict):
    """Main Method"""
    trim_images = partial(
        image_functions.open_image_and_get_measurements,
        do_trim=args.trim,
        remove_empty=args.removeempty,
    )

    remove_path_setup = partial(path_functions.remove_path, path_to_remove=args.inputdir)

    chars: list[classes.Character] = []
    for count, character_name in enumerate(
        (
            path
            for path in os.listdir(os.path.join(args.inputdir, "characters"))
            if os.path.isdir(os.path.join(args.inputdir, "characters", path))
        ),
        start=1,
    ):
        if not args.bounds:
            print(f"Character {count}: {character_name}")

        pose_list = []
        # default_outfit = False
        for pose_path in [
            os.path.join(args.inputdir, "characters", character_name, path)
            for path in os.listdir(os.path.join(args.inputdir, "characters", character_name))
            if os.path.isdir(os.path.join(args.inputdir, "characters", character_name, path))
        ]:
            pose_letter = pose_path.split(os.sep)[-1]

            if args.bounds:
                main_functions.bounds(
                    args.regex,
                    pose_path,
                    args.inputdir,
                    character_name,
                    args.skip_if_same,
                    args.skip_faces,
                    args.skip_outfits,
                )

            else:
                if not path_functions.check_character_is_valid(pose_path):
                    continue
                if char_pose := main_functions.create_character(
                    trim_images,
                    remove_path_setup,
                    character_name,
                    pose_path,
                    args.inputdir,
                    args.outfitprio,
                    pose_letter,
                ):
                    pose_list.append(classes.Pose(args.inputdir, pose_letter, *char_pose))

        if pose_list:
            chars.append(classes.Character(character_name, pose_list, args.maxheightmultiplier))

    if args.bounds:
        sys.exit()

    if not chars:
        print("No suitable characters exist. Read what each character is missing and add those to create html.")
        input("Press enter to exit...")
        sys.exit(1)

    print("Creating Html...")
    scenario_title = yml["title"]

    if args.onlyjson:
        main_functions.create_js(
            args,
            chars,
        )
    elif args.splitfiles:
        main_functions.create_html_file(
            args,
            scenario_title,
            html_snips,
            chars,
            split_files=True,
        )
        main_functions.create_js(
            args,
            chars,
        )

    else:
        main_functions.create_html_file(
            args,
            scenario_title,
            html_snips,
            chars,
        )


def main():
    "Main method"
    args = args_functions.get_args()
    yml_data = args_functions.setup_args(args)
    main_loop(args, yml_data)


if __name__ == "__main__":
    main()
